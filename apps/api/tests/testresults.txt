C:\Git_Repos\mana_meeples_singles_market>pnpm --filter ./apps/api test

> @mana-meeples/api@ test C:\Git_Repos\mana_meeples_singles_market\apps\api
> vitest


 DEV  v2.1.9 C:/Git_Repos/mana_meeples_singles_market/apps/api

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:00.909Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
âŒ Missing credentials

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with invalid credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:00.929Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with invalid credentials
âŒ Invalid credentials

stdout | tests/integration/cards.search.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

stderr | tests/integration/cards.search.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:02.001Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
âŒ Invalid credentials

stdout | tests/e2e/checkout.flow.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/error-handling.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/logout > clears the admin token cookie
ğŸ” AUTH POST /api/auth/admin/logout - 2025-10-21T23:53:03.067Z
ğŸšª Admin logout request

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns 401 when no token provided
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-21T23:53:03.075Z

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:03.084Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...

stdout | tests/integration/orders.routes.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/inventory.routes.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
âŒ Invalid credentials

stdout | tests/integration/storefront.routes.test.ts
[dotenv@17.2.3] injecting env (21) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

stdout | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:03.160Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
âŒ Missing credentials

stderr | tests/integration/error-handling.test.ts > Error Handling > 401 Unauthorized > returns 401 for protected routes without auth
âŒ No admin token found in cookies

stdout | tests/integration/orders.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:03.174Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...

stdout | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:03.178Z
ğŸ”‘ Admin login attempt - handler entered

stderr | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
âŒ Login error: TypeError: Cannot destructure property 'username' of 'req.body' as it is undefined.
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\auth.ts:32:13
    at Layer.handleRequest (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\layer.js:152:17)
    at next (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\route.js:157:13)
    at Route.dispatch (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\route.js:117:3)
    at handle (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:435:11)
    at Layer.handleRequest (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\layer.js:152:17)
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:295:15
    at processParams (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:582:12)
    at next (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:291:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\auth.ts:21:3
âŒ Error stack: TypeError: Cannot destructure property 'username' of 'req.body' as it is undefined.
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\auth.ts:32:13
    at Layer.handleRequest (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\layer.js:152:17)
    at next (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\route.js:157:13)
    at Route.dispatch (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\route.js:117:3)
    at handle (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:435:11)
    at Layer.handleRequest (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\lib\layer.js:152:17)
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:295:15
    at processParams (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:582:12)
    at next (C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\router@2.2.0\node_modules\router\index.js:291:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\auth.ts:21:3

stdout | tests/integration/inventory.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-21T23:53:03.203Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...

stdout | tests/integration/orders.routes.test.ts
âŒ Invalid credentials

stdout | tests/integration/inventory.routes.test.ts
âŒ Invalid credentials

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > completes a full customer journey from browsing to order placement
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
âŒ Database query error: relation "card_pricing" does not exist
   Query:
    WITH latest_prices AS (
      SELECT DISTINCT ON (card_id)
             card_id, base_price, foil_price, price_source, updated_at
      FROM card_pricing
      ORDER BY card_id, updated_at DESC N
   Params: [100,0]
   Code: 42P01
GET /storefront/cards failed { code: '42P01', message: 'relation "card_pricing" does not exist' }

 â¯ tests/e2e/checkout.flow.test.ts (6) 16861ms
   â¯ Complete Checkout Flow (E2E) (6) 851ms
     Ã— completes a full customer journey from browsing to order placement
     Ã— handles out-of-stock scenario gracefully
     Ã— handles concurrent orders for the same item
     Ã— allows admin to cancel an order and restore inventory
     Ã— validates customer input sanitization during checkout
     Ã— handles multiple items in a single order
 â¯ tests/integration/auth.routes.test.ts (6) 17267ms
   â¯ POST /api/auth/admin/login (3) 2187ms
     âœ“ rejects login with missing credentials
     âœ“ rejects login with invalid credentials 1073ms
     Ã— accepts valid admin credentials and sets cookie 1068ms
   âœ“ POST /api/auth/admin/logout (1)
   â¯ GET /api/auth/admin/check (2) 1082ms
     Ã— returns 401 when no token provided
     Ã— returns authenticated status with valid token 1073ms
 âœ“ tests/integration/cards.search.test.ts (1) 14721ms
 â¯ tests/integration/error-handling.test.ts (7) 16131ms
   â¯ Error Handling (7)
     âœ“ 404 Not Found (2)
     âœ“ 400 Bad Request (2)
     âœ“ 401 Unauthorized (1)
     â¯ 500 Internal Server Error (1)
       Ã— handles database errors gracefully
     â¯ Content-Type validation (1)
       Ã— requires JSON content-type for POST requests
 â¯ tests/integration/inventory.routes.test.ts (16) 17625ms
   / [ beforeAll ]
   â†“ POST /api/admin/inventory (6) [skipped]
   â†“ GET /api/admin/inventory (3) [skipped]
   â†“ PATCH /api/admin/inventory/:id (4) [skipped]
   â†“ DELETE /api/admin/inventory/:id (3) [skipped]
 â¯ tests/integration/orders.routes.test.ts (19) 17422ms
   / [ beforeAll ]
   â†“ POST /api/orders (6) [skipped]
   â†“ GET /api/admin/orders (5) [skipped]
   â†“ GET /api/admin/orders/:id (3) [skipped]
   â†“ PATCH /api/admin/orders/:id/status (5) [skipped]
 â¯ tests/integration/storefront.routes.test.ts (5) 16245ms
   â¯ GET /api/storefront/cards (5) 309ms
     Ã— returns paginated cards with default params
       | [ beforeEach ]
     Ã— filters cards by game_id
       | [ beforeEach ]
     Ã— filters cards by search term
       / [ beforeEach ]
     Ã— respects pagination parameters
       \ [ beforeEach ]
     Ã— returns 400 for invalid query parameters
       / [ beforeEach ]
 âœ“ tests/unit/auth.validateCredentials.test.ts (4)
 âœ“ tests/unit/slugify.test.ts (1)
 â¯ tests/unit/utils.test.ts (42)
   â¯ String Utilities (24)
     â¯ slugify (10)
       âœ“ converts text to lowercase
       âœ“ replaces spaces with hyphens
       âœ“ removes special characters
       Ã— handles unicode characters
       âœ“ removes leading and trailing hyphens
       âœ“ collapses multiple hyphens to single hyphen
       âœ“ handles empty string
       âœ“ handles string with only special characters
       âœ“ preserves numbers
       âœ“ handles underscores
     âœ“ truncate (6)
     âœ“ titleCase (8)
   âœ“ Database Query Builders (1)
   âœ“ Validation Helpers (1)
   âœ“ Price Formatting (4)
   âœ“ Date Utilities (4)
   âœ“ Array Utilities (8)
 âœ“ tests/unit/validation.test.ts (10)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Suites 2 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/inventory.routes.test.ts [ tests/integration/inventory.routes.test.ts ]
TypeError: Cannot read properties of undefined (reading '0')
 â¯ tests/integration/inventory.routes.test.ts:27:44
     25|     });
     26|
     27|   authToken = loginRes.headers["set-cookie"][0];
       |                                            ^
     28| }, 60_000);
     29|

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/19]â¯

 FAIL  tests/integration/orders.routes.test.ts [ tests/integration/orders.routes.test.ts ]
TypeError: Cannot read properties of undefined (reading '0')
 â¯ tests/integration/orders.routes.test.ts:27:44
     25|     });
     26|
     27|   authToken = loginRes.headers["set-cookie"][0];
       |                                            ^
     28| }, 60_000);
     29|

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/19]â¯

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Tests 17 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > completes a full customer journey from browsing to order placement
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:36:8
     34|     const browseRes = await request(app)
     35|       .get("/api/storefront/cards")
     36|       .expect(200);
       |        ^
     37|
     38|     expect(browseRes.body.cards).toBeDefined();
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/19]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:165:8
    163|     const browseRes = await request(app)
    164|       .get("/api/storefront/cards")
    165|       .expect(200);
       |        ^
    166|
    167|     const card = browseRes.body.cards[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/19]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:205:8
    203|     const browseRes = await request(app)
    204|       .get("/api/storefront/cards")
    205|       .expect(200);
       |        ^
    206|
    207|     const card = browseRes.body.cards[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/19]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:258:8
    256|     const browseRes = await request(app)
    257|       .get("/api/storefront/cards")
    258|       .expect(200);
       |        ^
    259|
    260|     const card = browseRes.body.cards[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/19]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:330:8
    328|     const browseRes = await request(app)
    329|       .get("/api/storefront/cards")
    330|       .expect(200);
       |        ^
    331|
    332|     const card = browseRes.body.cards[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/19]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:390:8
    388|     const browseRes = await request(app)
    389|       .get("/api/storefront/cards")
    390|       .expect(200);
       |        ^
    391|
    392|     const card = browseRes.body.cards[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/19]â¯

 FAIL  tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
Error: expected 200 "OK", got 401 "Unauthorized"
 â¯ tests/integration/auth.routes.test.ts:51:8
     49|         password: process.env.ADMIN_PASSWORD || "your_test_password"
     50|       })
     51|       .expect(200);
       |        ^
     52|
     53|     expect(res.body.success).toBe(true);
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/19]â¯

 FAIL  tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns 401 when no token provided
Error: expected 401 "Unauthorized", got 404 "Not Found"
 â¯ tests/integration/auth.routes.test.ts:75:8
     73|     const res = await request(app)
     74|       .get("/api/auth/admin/check")
     75|       .expect(401);
       |        ^
     76|
     77|     expect(res.body.authenticated).toBe(false);
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/19]â¯

 FAIL  tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
TypeError: Invalid value "undefined" for header "Cookie"
 â¯ Test.request ../../node_modules/.pnpm/superagent@10.2.3/node_modules/superagent/src/node/index.js:830:39
 â¯ Test.Request.end ../../node_modules/.pnpm/superagent@10.2.3/node_modules/superagent/src/node/index.js:965:8
 â¯ Test.end ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:136:11
 â¯ ../../node_modules/.pnpm/superagent@10.2.3/node_modules/superagent/src/request-base.js:283:12
 â¯ Test.RequestBase.then ../../node_modules/.pnpm/superagent@10.2.3/node_modules/superagent/src/request-base.js:265:31

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/19]â¯

 FAIL  tests/integration/error-handling.test.ts > Error Handling > 500 Internal Server Error > handles database errors gracefully
AssertionError: expected undefined to be defined
 â¯ tests/integration/error-handling.test.ts:76:27
     74|       // This would require mocking the database to fail
     75|       // For now, we can test the error handler is in place
     76|       expect(app._router).toBeDefined();
       |                           ^
     77|     });
     78|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/19]â¯

 FAIL  tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/integration/error-handling.test.ts:85:10
     83|         .post("/api/auth/admin/login")
     84|         .send("not-json-data")
     85|         .expect(400);
       |          ^
     86|
     87|       // Should fail to parse as JSON
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/19]â¯

 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > returns paginated cards with default params
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > filters cards by game_id
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > filters cards by search term
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > respects pagination parameters
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > returns 400 for invalid query parameters
error: relation "card_sets" does not exist
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedMultipleCards tests/setup/db.ts:65:5
     63|
     64|     // Seed card sets
     65|     await client.query(
       |     ^
     66|       `INSERT INTO card_sets (id, name, game_id) VALUES
     67|        (1, 'Alpha', 1),
 â¯ tests/integration/storefront.routes.test.ts:26:5

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/19]â¯

 FAIL  tests/unit/utils.test.ts > String Utilities > slugify > handles unicode characters
AssertionError: expected 'caf-mnchn' to be 'caf-mnchen' // Object.is equality

Expected: "caf-mnchen"
Received: "caf-mnchn"

 â¯ tests/unit/utils.test.ts:22:39
     20|
     21|     it("handles unicode characters", () => {
     22|       expect(slugify("CafÃ© MÃ¼nchÃ«n")).toBe("caf-mnchen");
       |                                       ^
     23|     });
     24|

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/19]â¯

 Test Files  7 failed | 4 passed (11)
      Tests  17 failed | 65 passed | 35 skipped (117)
   Start at  12:52:46
   Duration  18.83s (transform 608ms, setup 0ms, collect 6.34s, tests 116.43s, environment 2ms, prepare 1.33s)

 FAIL  Tests failed. Watching for file changes...