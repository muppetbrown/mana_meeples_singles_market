C:\Git_Repos\mana_meeples_singles_market>pnpm --filter ./apps/api test

> @mana-meeples/api@ test C:\Git_Repos\mana_meeples_singles_market\apps\api
> vitest


 DEV  v2.1.9 C:/Git_Repos/mana_meeples_singles_market/apps/api

stdout | tests/integration/error-handling.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232224.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232224.txt

stdout | tests/integration/auth.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232222.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232222.txt

stdout | tests/integration/cards.search.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232228.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232228.txt

stdout | tests/e2e/checkout.flow.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232227.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232227.txt

stdout | tests/integration/storefront.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232241.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232241.txt

stdout | tests/integration/orders.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232242.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232242.txt

stdout | tests/integration/inventory.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232240.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232240.txt

stdout | tests/integration/inventory.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/e2e/checkout.flow.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/inventory.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:20.327Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/cards.search.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/integration/cards.search.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:21.094Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
âŒ Missing credentials

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with invalid credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:21.108Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âŒ Invalid credentials

stdout | tests/integration/storefront.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/integration/cards.search.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232228.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232228.json

stdout | tests/integration/error-handling.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:22.069Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
âŒ Missing credentials

stderr | tests/integration/error-handling.test.ts > Error Handling > 401 Unauthorized > returns 401 for protected routes without auth
âŒ No admin token found in cookies

stdout | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:22.085Z
ğŸ”‘ Admin login attempt - handler entered

stderr | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
âŒ Invalid request body

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:22.129Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/logout > clears the admin token cookie
ğŸ” AUTH POST /api/auth/admin/logout - 2025-10-22T17:47:22.135Z
ğŸšª Admin logout request

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns 401 when no token provided
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T17:47:22.139Z
ğŸ” Admin auth check request
âŒ No admin token found

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:22.146Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T17:47:22.153Z
ğŸ” Admin auth check request
ğŸ” Verifying token...
âœ… Auth check successful for: admin

stdout | tests/integration/orders.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

stdout | tests/integration/orders.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:47:22.325Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/error-handling.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232224.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232224.json

stdout | tests/integration/auth.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232222.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232222.json

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/integration/orders.routes.test.ts > POST /api/orders > creates a new order with valid data
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/integration/storefront.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/e2e/checkout.flow.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stderr | tests/e2e/checkout.flow.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/storefront.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232241.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232241.json

stdout | tests/e2e/checkout.flow.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232227.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232227.json

stderr | tests/integration/orders.routes.test.ts > POST /api/orders > handles transaction rollback on inventory update failure
âŒ Create order error: error: column "subtotal" of relation "orders" does not exist
    at C:\Git_Repos\mana_meeples_singles_market\node_modules\.pnpm\pg@8.16.3\node_modules\pg\lib\client.js:545:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:89:27 {
  length: 128,
  severity: 'ERROR',
  code: '42703',
  detail: undefined,
  hint: undefined,
  position: '138',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'parse_target.c',
  line: '1066',
  routine: 'checkInsertTargets'
}

stderr | tests/integration/inventory.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/inventory.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232240.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232240.json

stderr | tests/integration/orders.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/orders.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232242.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761155232242.json

 â¯ tests/e2e/checkout.flow.test.ts (6) 17138ms
   â¯ Complete Checkout Flow (E2E) (6) 8213ms
     Ã— completes a full customer journey from browsing to order placement 1594ms
     Ã— handles out-of-stock scenario gracefully 1389ms
     Ã— handles concurrent orders for the same item 1348ms
     Ã— allows admin to cancel an order and restore inventory 1344ms
     Ã— validates customer input sanitization during checkout 1268ms
     Ã— handles multiple items in a single order 1270ms
 âœ“ tests/integration/auth.routes.test.ts (6) 11062ms
 âœ“ tests/integration/cards.search.test.ts (1) 9094ms
 âœ“ tests/integration/error-handling.test.ts (7) 10843ms
 â¯ tests/integration/inventory.routes.test.ts (16) 25780ms
   â¯ POST /api/admin/inventory (6) 7976ms
     Ã— requires authentication 1541ms
     âœ“ creates new inventory with valid data 1299ms
     Ã— updates existing inventory on conflict 1315ms
     âœ“ rejects invalid card_id 1324ms
     âœ“ rejects negative stock quantity 1231ms
     âœ“ rejects missing required fields 1265ms
   â¯ GET /api/admin/inventory (3) 2886ms
     Ã— requires authentication 1003ms
     Ã— returns paginated inventory list 921ms
     Ã— filters inventory by card_id 962ms
   â¯ PATCH /api/admin/inventory/:id (4) 3518ms
     Ã— requires authentication 878ms
     Ã— updates inventory stock quantity 870ms
     Ã— updates inventory price 880ms
     âœ“ returns 404 for non-existent inventory 891ms
   â¯ DELETE /api/admin/inventory/:id (3) 2667ms
     Ã— requires authentication 893ms
     Ã— deletes inventory item 896ms
     âœ“ returns 404 for non-existent inventory 878ms
 â¯ tests/integration/orders.routes.test.ts (19) 28133ms
   â¯ POST /api/orders (6) 7438ms
     Ã— creates a new order with valid data 1385ms
     Ã— validates required customer fields 1274ms
     âœ“ validates items array is not empty 1327ms
     âœ“ validates item quantity limits 1277ms
     âœ“ validates email format 1217ms
     Ã— handles transaction rollback on inventory update failure 959ms
   â¯ GET /api/admin/orders (5) 4495ms
     Ã— requires authentication 874ms
       - [ beforeEach ]
     Ã— returns paginated orders list 944ms
       | [ beforeEach ]
     Ã— filters orders by status 904ms
       \ [ beforeEach ]
     Ã— supports pagination 877ms
       | [ beforeEach ]
     Ã— searches orders by customer email 896ms
       | [ beforeEach ]
   â¯ GET /api/admin/orders/:id (3) 2653ms
     Ã— requires authentication 876ms
       - [ beforeEach ]
     Ã— returns order details 902ms
       \ [ beforeEach ]
     Ã— returns 404 for non-existent order 875ms
       / [ beforeEach ]
   â¯ PATCH /api/admin/orders/:id/status (5) 2845ms
     Ã— requires authentication 735ms
       \ [ beforeEach ]
     Ã— updates order status 574ms
       / [ beforeEach ]
     Ã— validates status enum values 521ms
       - [ beforeEach ]
     Ã— allows adding notes when updating status 496ms
       | [ beforeEach ]
     Ã— returns 404 for non-existent order 517ms
       - [ beforeEach ]
 âœ“ tests/integration/storefront.routes.test.ts (5) 16374ms
 âœ“ tests/unit/auth.validateCredentials.test.ts (4)
 âœ“ tests/unit/slugify.test.ts (1)
 âœ“ tests/unit/utils.test.ts (43)
 âœ“ tests/unit/validation.test.ts (10)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Tests 32 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > completes a full customer journey from browsing to order placement
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/e2e/checkout.flow.test.ts:49:8
     47|     const cardDetailsRes = await request(app)
     48|       .get(`/api/storefront/cards/${selectedCard.id}`)
     49|       .expect(200);
       |        ^
     50|
     51|     expect(cardDetailsRes.body.card).toBeDefined();
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/32]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:191:8
    189|       .post("/api/orders")
    190|       .send(orderData)
    191|       .expect(400);
       |        ^
    192|
    193|     expect(orderRes.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/32]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ tests/e2e/checkout.flow.test.ts:246:30
    244|     const failed = results.filter(r => r.status === 400);
    245|
    246|     expect(succeeded.length).toBe(1);
       |                              ^
    247|     expect(failed.length).toBe(1);
    248|     expect(failed[0].body.error).toMatch(/stock|inventory/i);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/32]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
Error: expected 201 "Created", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:282:8
    280|       .post("/api/orders")
    281|       .send(orderData)
    282|       .expect(201);
       |        ^
    283|
    284|     const orderId = orderRes.body.order.id;
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/32]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
Error: expected 201 "Created", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:356:8
    354|       .post("/api/orders")
    355|       .send(maliciousOrderData)
    356|       .expect(201);
       |        ^
    357|
    358|     // Verify malicious content was sanitized
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/32]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
Error: expected 201 "Created", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:412:8
    410|       .post("/api/orders")
    411|       .send(orderData)
    412|       .expect(201);
       |        ^
    413|
    414|     expect(orderRes.body.order).toBeDefined();
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > requires authentication
Error: expected 401 "Unauthorized", got 200 "OK"
 â¯ tests/integration/inventory.routes.test.ts:51:8
     49|         language: "English"
     50|       })
     51|       .expect(401);
       |        ^
     52|
     53|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > updates existing inventory on conflict
AssertionError: expected '7.99' to be 7.99 // Object.is equality

- Expected:
7.99

+ Received:
"7.99"

 â¯ tests/integration/inventory.routes.test.ts:104:38
    102|       .expect(200);
    103|
    104|     expect(res.body.inventory.price).toBe(7.99);
       |                                      ^
    105|     expect(res.body.inventory.stock_quantity).toBe(20);
    106|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > requires authentication
Error: expected 401 "Unauthorized", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:167:8
    165|     const res = await request(app)
    166|       .get("/api/admin/inventory")
    167|       .expect(401);
       |        ^
    168|
    169|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > returns paginated inventory list
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:176:8
    174|       .get("/api/admin/inventory")
    175|       .set("Cookie", authToken)
    176|       .expect(200);
       |        ^
    177|
    178|     expect(res.body).toHaveProperty("inventory");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > filters inventory by card_id
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:187:8
    185|       .set("Cookie", authToken)
    186|       .query({ card_id: 1001 })
    187|       .expect(200);
       |        ^
    188|
    189|     expect(res.body.inventory).toBeDefined();
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > requires authentication
Error: expected 401 "Unauthorized", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:207:8
    205|       .patch(`/api/admin/inventory/${inventoryId}`)
    206|       .send({ stock_quantity: 20 })
    207|       .expect(401);
       |        ^
    208|
    209|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > updates inventory stock quantity
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:217:8
    215|       .set("Cookie", authToken)
    216|       .send({ stock_quantity: 25 })
    217|       .expect(200);
       |        ^
    218|
    219|     expect(res.body.inventory.stock_quantity).toBe(25);
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > updates inventory price
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:227:8
    225|       .set("Cookie", authToken)
    226|       .send({ price: 9.99 })
    227|       .expect(200);
       |        ^
    228|
    229|     expect(res.body.inventory.price).toBe(9.99);
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > requires authentication
Error: expected 401 "Unauthorized", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:253:8
    251|     const res = await request(app)
    252|       .delete(`/api/admin/inventory/${inventoryId}`)
    253|       .expect(401);
       |        ^
    254|
    255|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/32]â¯

 FAIL  tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > deletes inventory item
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/inventory.routes.test.ts:262:8
    260|       .delete(`/api/admin/inventory/${inventoryId}`)
    261|       .set("Cookie", authToken)
    262|       .expect(200);
       |        ^
    263|
    264|     expect(res.body).toHaveProperty("success");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > creates a new order with valid data
Error: expected 201 "Created", got 500 "Internal Server Error"
 â¯ tests/integration/orders.routes.test.ts:69:8
     67|       .post("/api/orders")
     68|       .send(orderData)
     69|       .expect(201);
       |        ^
     70|
     71|     expect(res.body).toHaveProperty("order");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates required customer fields
AssertionError: expected 'Invalid order data' to contain 'email'

Expected: "email"
Received: "Invalid order data"

 â¯ tests/integration/orders.routes.test.ts:101:28
     99|
    100|     expect(res.body).toHaveProperty("error");
    101|     expect(res.body.error).toContain("email");
       |                            ^
    102|   });
    103|

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > handles transaction rollback on inventory update failure
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/integration/orders.routes.test.ts:195:8
    193|       .post("/api/orders")
    194|       .send(orderData)
    195|       .expect(400);
       |        ^
    196|
    197|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > returns paginated orders list
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > filters orders by status
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > supports pagination
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > searches orders by customer email
error: column "subtotal" of relation "orders" does not exist
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.createTestOrder tests/setup/db.ts:156:17
    154|     `);
    155|
    156|     const res = await client.query(
       |                 ^
    157|       `INSERT INTO orders (customer_email, customer_name, subtotal, tax, shipping, total, status)
    158|        VALUES ($1, $2, $3, $4, $5, $6, $7)
 â¯ tests/integration/orders.routes.test.ts:203:5

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > returns order details
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > returns 404 for non-existent order
error: column "subtotal" of relation "orders" does not exist
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.createTestOrder tests/setup/db.ts:156:17
    154|     `);
    155|
    156|     const res = await client.query(
       |                 ^
    157|       `INSERT INTO orders (customer_email, customer_name, subtotal, tax, shipping, total, status)
    158|        VALUES ($1, $2, $3, $4, $5, $6, $7)
 â¯ tests/integration/orders.routes.test.ts:264:15

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/32]â¯

 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > updates order status
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > validates status enum values
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > allows adding notes when updating status
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > returns 404 for non-existent order
error: column "subtotal" of relation "orders" does not exist
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.createTestOrder tests/setup/db.ts:156:17
    154|     `);
    155|
    156|     const res = await client.query(
       |                 ^
    157|       `INSERT INTO orders (customer_email, customer_name, subtotal, tax, shipping, total, status)
    158|        VALUES ($1, $2, $3, $4, $5, $6, $7)
 â¯ tests/integration/orders.routes.test.ts:300:15

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/32]â¯

 Test Files  3 failed | 8 passed (11)
      Tests  32 failed | 86 passed (118)
   Start at  06:47:11
   Duration  29.29s (transform 609ms, setup 0ms, collect 6.17s, tests 118.57s, environment 2ms, prepare 1.33s)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit