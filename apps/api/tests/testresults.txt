C:\Git_Repos\mana_meeples_singles_market>pnpm --filter ./apps/api test

> @mana-meeples/api@ test C:\Git_Repos\mana_meeples_singles_market\apps\api
> vitest


 DEV  v2.1.9 C:/Git_Repos/mana_meeples_singles_market/apps/api

stdout | tests/integration/storefront.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.txt

stdout | tests/e2e/checkout.flow.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt

stdout | tests/integration/error-handling.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt

stdout | tests/integration/inventory.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt

stdout | tests/integration/auth.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.txt

stdout | tests/integration/cards.search.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530374.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530374.txt

stdout | tests/integration/orders.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530375.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530375.txt

stdout | tests/integration/inventory.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/error-handling.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/e2e/checkout.flow.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

stdout | tests/integration/inventory.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:38.567Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/storefront.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

stdout | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:38.606Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
âŒ Missing credentials

stderr | tests/integration/error-handling.test.ts > Error Handling > 401 Unauthorized > returns 401 for protected routes without auth
âŒ No admin token found in cookies

stdout | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:38.627Z
ğŸ”‘ Admin login attempt - handler entered

stderr | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
âŒ Invalid request body

stdout | tests/integration/orders.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/orders.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:39.261Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:39.419Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
âŒ Missing credentials

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with invalid credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:39.426Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âŒ Invalid credentials

stdout | tests/integration/error-handling.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json

stdout | tests/integration/cards.search.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530374.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530374.json

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:40.442Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/logout > clears the admin token cookie
ğŸ” AUTH POST /api/auth/admin/logout - 2025-10-22T17:35:40.450Z
ğŸšª Admin logout request

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns 401 when no token provided
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T17:35:40.458Z
ğŸ” Admin auth check request
âŒ No admin token found

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T17:35:40.464Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T17:35:40.474Z
ğŸ” Admin auth check request
ğŸ” Verifying token...
âœ… Auth check successful for: admin

stdout | tests/integration/auth.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.json

stdout | tests/integration/storefront.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530372.json

stdout | tests/e2e/checkout.flow.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json

stdout | tests/integration/inventory.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530373.json

stdout | tests/integration/orders.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530375.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761154530375.json

 â¯ tests/e2e/checkout.flow.test.ts (6) 16917ms
   â¯ Complete Checkout Flow (E2E) (6) 7915ms
     Ã— completes a full customer journey from browsing to order placement 1339ms
     Ã— handles out-of-stock scenario gracefully 1502ms
     Ã— handles concurrent orders for the same item 1282ms
     Ã— allows admin to cancel an order and restore inventory 1284ms
     Ã— validates customer input sanitization during checkout 1326ms
     Ã— handles multiple items in a single order 1182ms
 âœ“ tests/integration/auth.routes.test.ts (6) 11097ms
 â¯ tests/integration/cards.search.test.ts (1) 9765ms
   / [ beforeAll ]
   â†“ GET /api/cards/cards (1) [skipped]
 âœ“ tests/integration/error-handling.test.ts (7) 9076ms
 â¯ tests/integration/inventory.routes.test.ts (16) 26011ms
   â¯ POST /api/admin/inventory (6) 7904ms
     Ã— requires authentication 1277ms
       | [ beforeEach ]
     Ã— creates new inventory with valid data 1346ms
       - [ beforeEach ]
     Ã— updates existing inventory on conflict 1487ms
       - [ beforeEach ]
     Ã— rejects invalid card_id 1277ms
       \ [ beforeEach ]
     Ã— rejects negative stock quantity 1307ms
       \ [ beforeEach ]
     Ã— rejects missing required fields 1210ms
       | [ beforeEach ]
   â¯ GET /api/admin/inventory (3) 2906ms
     Ã— requires authentication 1093ms
       | [ beforeEach ]
     Ã— returns paginated inventory list 890ms
       / [ beforeEach ]
     Ã— filters inventory by card_id 923ms
       | [ beforeEach ]
   â¯ PATCH /api/admin/inventory/:id (4) 3605ms
     Ã— requires authentication 897ms
       - [ beforeEach ]
     Ã— updates inventory stock quantity 889ms
       / [ beforeEach ]
     Ã— updates inventory price 907ms
       / [ beforeEach ]
     Ã— returns 404 for non-existent inventory 912ms
       | [ beforeEach ]
   â¯ DELETE /api/admin/inventory/:id (3) 2657ms
     Ã— requires authentication 880ms
       - [ beforeEach ]
     Ã— deletes inventory item 886ms
       | [ beforeEach ]
     Ã— returns 404 for non-existent inventory 891ms
       \ [ beforeEach ]
 â¯ tests/integration/orders.routes.test.ts (19) 27860ms
   â¯ POST /api/orders (6) 7897ms
     Ã— creates a new order with valid data 1390ms
       \ [ beforeEach ]
     Ã— validates required customer fields 1479ms
       | [ beforeEach ]
     Ã— validates items array is not empty 1297ms
       - [ beforeEach ]
     Ã— validates item quantity limits 1294ms
       / [ beforeEach ]
     Ã— validates email format 1229ms
       | [ beforeEach ]
     Ã— handles transaction rollback on inventory update failure 1208ms
       | [ beforeEach ]
   â¯ GET /api/admin/orders (5) 4460ms
     Ã— requires authentication 906ms
       / [ beforeEach ]
     Ã— returns paginated orders list 904ms
       - [ beforeEach ]
     Ã— filters orders by status 876ms
       | [ beforeEach ]
     Ã— supports pagination 886ms
       / [ beforeEach ]
     Ã— searches orders by customer email 888ms
       / [ beforeEach ]
   â¯ GET /api/admin/orders/:id (3) 2700ms
     Ã— requires authentication 907ms
       \ [ beforeEach ]
     Ã— returns order details 888ms
       | [ beforeEach ]
     Ã— returns 404 for non-existent order 905ms
       / [ beforeEach ]
   â¯ PATCH /api/admin/orders/:id/status (5) 3283ms
     Ã— requires authentication 867ms
       \ [ beforeEach ]
     Ã— updates order status 731ms
       | [ beforeEach ]
     Ã— validates status enum values 664ms
       - [ beforeEach ]
     Ã— allows adding notes when updating status 512ms
       \ [ beforeEach ]
     Ã— returns 404 for non-existent order 510ms
       \ [ beforeEach ]
 â¯ tests/integration/storefront.routes.test.ts (5) 15886ms
   â¯ GET /api/storefront/cards (5) 6810ms
     Ã— returns paginated cards with default params 1350ms
       | [ beforeEach ]
     Ã— filters cards by game_id 1519ms
       | [ beforeEach ]
     Ã— filters cards by search term 1319ms
       | [ beforeEach ]
     Ã— respects pagination parameters 1299ms
       | [ beforeEach ]
     Ã— returns 400 for invalid query parameters 1321ms
       | [ beforeEach ]
 âœ“ tests/unit/auth.validateCredentials.test.ts (4)
 âœ“ tests/unit/slugify.test.ts (1)
 âœ“ tests/unit/utils.test.ts (43)
 âœ“ tests/unit/validation.test.ts (10)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Suites 1 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/cards.search.test.ts [ tests/integration/cards.search.test.ts ]
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/integration/cards.search.test.ts:15:3

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/47]â¯

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Tests 46 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > completes a full customer journey from browsing to order placement
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:30:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/47]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:159:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/47]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:199:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/47]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:253:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/47]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:325:20

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/47]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/e2e/checkout.flow.test.ts:382:21

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/47]â¯

 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > requires authentication
 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > creates new inventory with valid data
 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > updates existing inventory on conflict
 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > rejects invalid card_id
 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > rejects negative stock quantity
 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > rejects missing required fields
 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > requires authentication
 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > returns paginated inventory list
 FAIL  tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > filters inventory by card_id
 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > requires authentication
 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > updates inventory stock quantity
 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > updates inventory price
 FAIL  tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > returns 404 for non-existent inventory
 FAIL  tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > requires authentication
 FAIL  tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > deletes inventory item
 FAIL  tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > returns 404 for non-existent inventory
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/integration/inventory.routes.test.ts:36:3

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/47]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > creates a new order with valid data
 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates required customer fields
 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates items array is not empty
 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates item quantity limits
 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates email format
 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > handles transaction rollback on inventory update failure
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > returns paginated orders list
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > filters orders by status
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > supports pagination
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders > searches orders by customer email
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > returns order details
 FAIL  tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > returns 404 for non-existent order
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > requires authentication
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > updates order status
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > validates status enum values
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > allows adding notes when updating status
 FAIL  tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > returns 404 for non-existent order
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedCards tests/setup/db.ts:36:17
     34|     );
     35|
     36|     const res = await client.query(
       |                 ^
     37|       `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     38|        VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/integration/orders.routes.test.ts:36:3

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/47]â¯

 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > returns paginated cards with default params
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > filters cards by game_id
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > filters cards by search term
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > respects pagination parameters
 FAIL  tests/integration/storefront.routes.test.ts > GET /api/storefront/cards > returns 400 for invalid query parameters
error: null value in column "game_id" of relation "cards" violates not-null constraint
 â¯ ../../node_modules/.pnpm/pg@8.16.3/node_modules/pg/lib/client.js:545:17
 â¯ Module.seedMultipleCards tests/setup/db.ts:83:7
     81|
     82|     for (const card of cards) {
     83|       await client.query(
       |       ^
     84|         `INSERT INTO cards (id, set_id, card_number, finish, name, sku)
     85|          VALUES ($1,$2,$3,$4,$5,$6)
 â¯ tests/integration/storefront.routes.test.ts:26:5

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/47]â¯

 Test Files  5 failed | 6 passed (11)
      Tests  46 failed | 71 passed | 1 skipped (118)
   Start at  06:35:29
   Duration  29.15s (transform 547ms, setup 0ms, collect 6.99s, tests 116.76s, environment 2ms, prepare 1.38s)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit