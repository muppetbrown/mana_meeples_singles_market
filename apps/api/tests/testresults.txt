C:\Git_Repos\mana_meeples_singles_market>pnpm --filter ./apps/api test

> @mana-meeples/api@ test C:\Git_Repos\mana_meeples_singles_market\apps\api
> vitest


 DEV  v2.1.9 C:/Git_Repos/mana_meeples_singles_market/apps/api

stdout | tests/integration/auth.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.txt

stdout | tests/integration/error-handling.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453696.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453696.txt

stdout | tests/integration/inventory.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.txt

stdout | tests/integration/storefront.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453692.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453692.txt

stdout | tests/integration/orders.routes.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.txt

stdout | tests/e2e/checkout.flow.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453687.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453687.txt

stdout | tests/integration/cards.search.test.ts
ğŸ“ Test logging initialized:
   JSON: C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.json
   TXT:  C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.txt

stdout | tests/integration/cards.search.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/error-handling.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:41.765Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with missing credentials
âŒ Missing credentials

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > rejects login with invalid credentials
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:41.774Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âŒ Invalid credentials

stdout | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:41.791Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'MISSING', hasPassword: false }

stderr | tests/integration/error-handling.test.ts > Error Handling > 400 Bad Request > returns 400 for malformed request body
âŒ Missing credentials

stderr | tests/integration/error-handling.test.ts > Error Handling > 401 Unauthorized > returns 401 for protected routes without auth
âŒ No admin token found in cookies

stdout | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:41.804Z
ğŸ”‘ Admin login attempt - handler entered

stderr | tests/integration/error-handling.test.ts > Error Handling > Content-Type validation > requires JSON content-type for POST requests
âŒ Invalid request body

stderr | tests/integration/cards.search.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/storefront.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

stdout | tests/e2e/checkout.flow.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/orders.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/orders.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:42.346Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/cards.search.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.json

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/login > accepts valid admin credentials and sets cookie
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:42.795Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > POST /api/auth/admin/logout > clears the admin token cookie
ğŸ” AUTH POST /api/auth/admin/logout - 2025-10-22T18:57:42.801Z
ğŸšª Admin logout request

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns 401 when no token provided
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T18:57:42.805Z
ğŸ” Admin auth check request
âŒ No admin token found

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:42.811Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/auth.routes.test.ts > GET /api/auth/admin/check > returns authenticated status with valid token
ğŸ” AUTH GET /api/auth/admin/check - 2025-10-22T18:57:42.816Z
ğŸ” Admin auth check request
ğŸ” Verifying token...
âœ… Auth check successful for: admin

stdout | tests/integration/inventory.routes.test.ts
[dotenv@17.2.3] injecting env (22) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/inventory.routes.test.ts
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:42.972Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/error-handling.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453696.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453696.json

stdout | tests/integration/auth.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.json

stderr | tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > requires authentication
âŒ No admin token found in cookies

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
âŒ Create order error: Error: Insufficient stock for Lightning Bolt
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:142:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)

stderr | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
âŒ Create order error: Error: Insufficient stock for item: Lightning Bolt
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:181:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)

stderr | tests/integration/storefront.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
ğŸ” AUTH POST /api/auth/admin/login - 2025-10-22T18:57:49.188Z
ğŸ”‘ Admin login attempt - handler entered
ğŸ“‹ Credentials received: { username: 'admin', hasPassword: true }
ğŸ” Validating credentials...
âœ… Credentials valid, generating token...
ğŸ« Token generated
ğŸª Setting cookie with config: {
  httpOnly: true,
  secure: false,
  sameSite: 'strict',
  domain: '(current domain)'
}
ğŸ“¤ Sending response: { success: true, message: 'Login successful', expiresIn: '24h' }
âœ… Response sent successfully

stdout | tests/integration/storefront.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453692.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453692.json

stderr | tests/integration/orders.routes.test.ts > POST /api/orders > handles transaction rollback on inventory update failure
âŒ Create order error: Error: Inventory item not found: 999999
    at C:\Git_Repos\mana_meeples_singles_market\apps\api\src\routes\orders.ts:135:17
    at processTicksAndRejections (node:internal/process/task_queues:95:5)

stderr | tests/e2e/checkout.flow.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/e2e/checkout.flow.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453687.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453687.json

stderr | tests/integration/orders.routes.test.ts > GET /api/admin/orders > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/inventory.routes.test.ts > GET /api/admin/inventory > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/inventory.routes.test.ts > PATCH /api/admin/inventory/:id > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/orders.routes.test.ts > GET /api/admin/orders/:id > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/inventory.routes.test.ts > DELETE /api/admin/inventory/:id > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/orders.routes.test.ts > PATCH /api/admin/orders/:id/status > requires authentication
âŒ No admin token found in cookies

stderr | tests/integration/inventory.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/inventory.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453689.json

stderr | tests/integration/orders.routes.test.ts
âš ï¸ Unexpected database pool error: terminating connection due to administrator command

stdout | tests/integration/orders.routes.test.ts

âœ… Test environment logs written:
   ğŸ“„ C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.txt
   ğŸ“Š C:\Git_Repos\mana_meeples_singles_market\apps\api\test-logs\test-env-1761159453691.json

 â¯ tests/e2e/checkout.flow.test.ts (6) 17369ms
   â¯ Complete Checkout Flow (E2E) (6) 8114ms
     Ã— completes a full customer journey from browsing to order placement 1530ms
     Ã— handles out-of-stock scenario gracefully 1326ms
     Ã— handles concurrent orders for the same item 1358ms
     Ã— allows admin to cancel an order and restore inventory 1418ms
     Ã— validates customer input sanitization during checkout 1325ms
     Ã— handles multiple items in a single order 1157ms
 âœ“ tests/integration/auth.routes.test.ts (6) 10049ms
 âœ“ tests/integration/cards.search.test.ts (1) 8960ms
 âœ“ tests/integration/error-handling.test.ts (7) 9326ms
 â¯ tests/integration/inventory.routes.test.ts (16) 26638ms
   â¯ POST /api/admin/inventory (6) 7624ms
     âœ“ requires authentication 1325ms
     âœ“ creates new inventory with valid data 1300ms
     Ã— updates existing inventory on conflict 1285ms
     âœ“ rejects invalid card_id 1380ms
     âœ“ rejects negative stock quantity 1263ms
     âœ“ rejects missing required fields 1070ms
   âœ“ GET /api/admin/inventory (3) 2735ms
   âœ“ PATCH /api/admin/inventory/:id (4) 3605ms
   âœ“ DELETE /api/admin/inventory/:id (3) 2683ms
 â¯ tests/integration/orders.routes.test.ts (19) 27970ms
   â¯ POST /api/orders (6) 7964ms
     Ã— creates a new order with valid data 1465ms
     Ã— validates required customer fields 1315ms
     âœ“ validates items array is not empty 1305ms
     âœ“ validates item quantity limits 1409ms
     âœ“ validates email format 1303ms
     Ã— handles transaction rollback on inventory update failure 1166ms
   âœ“ GET /api/admin/orders (5) 4565ms
   âœ“ GET /api/admin/orders/:id (3) 2703ms
   âœ“ PATCH /api/admin/orders/:id/status (5) 3536ms
 âœ“ tests/integration/storefront.routes.test.ts (5) 16106ms
 âœ“ tests/unit/auth.validateCredentials.test.ts (4)
 âœ“ tests/unit/slugify.test.ts (1)
 âœ“ tests/unit/utils.test.ts (43)
 âœ“ tests/unit/validation.test.ts (10)

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯ Failed Tests 10 â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > completes a full customer journey from browsing to order placement
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/e2e/checkout.flow.test.ts:49:8
     47|     const cardDetailsRes = await request(app)
     48|       .get(`/api/storefront/cards/${selectedCard.id}`)
     49|       .expect(200);
       |        ^
     50|
     51|     expect(cardDetailsRes.body.card).toBeDefined();
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/10]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles out-of-stock scenario gracefully
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/e2e/checkout.flow.test.ts:191:8
    189|       .post("/api/orders")
    190|       .send(orderData)
    191|       .expect(400);
       |        ^
    192|
    193|     expect(orderRes.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/10]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles concurrent orders for the same item
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ tests/e2e/checkout.flow.test.ts:247:27
    245|
    246|     expect(succeeded.length).toBe(1);
    247|     expect(failed.length).toBe(1);
       |                           ^
    248|     expect(failed[0].body.error).toMatch(/stock|inventory/i);
    249|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/10]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > allows admin to cancel an order and restore inventory
Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/e2e/checkout.flow.test.ts:289:8
    287|     const afterOrderRes = await request(app)
    288|       .get(`/api/storefront/cards/${card.id}`)
    289|       .expect(200);
       |        ^
    290|
    291|     const afterOrderVariation = afterOrderRes.body.card.variations[0];
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/10]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > validates customer input sanitization during checkout
AssertionError: expected '<script>alert(\'xss\')</script>' not to contain '<script>'

Expected: "<script>"
Received: "<script>alert('xss')</script>"

 â¯ tests/e2e/checkout.flow.test.ts:376:58
    374|
    375|     // Ensure no script tags in the stored data
    376|     expect(orderDetailsRes.body.order.customer_name).not.toContain("<script>");
       |                                                          ^
    377|     expect(orderDetailsRes.body.order.customer_name).not.toContain("</script>");
    378|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/10]â¯

 FAIL  tests/e2e/checkout.flow.test.ts > Complete Checkout Flow (E2E) > handles multiple items in a single order
AssertionError: expected 1 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 1

 â¯ tests/e2e/checkout.flow.test.ts:415:73
    413|
    414|     expect(orderRes.body.order).toBeDefined();
    415|     expect(orderRes.body.order.items?.length || orderData.items.length).toBe(2);
       |                                                                         ^
    416|   });
    417| });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/10]â¯

 FAIL  tests/integration/inventory.routes.test.ts > POST /api/admin/inventory > updates existing inventory on conflict
AssertionError: expected '7.99' to be 7.99 // Object.is equality

- Expected:
7.99

+ Received:
"7.99"

 â¯ tests/integration/inventory.routes.test.ts:104:38
    102|       .expect(200);
    103|
    104|     expect(res.body.inventory.price).toBe(7.99);
       |                                      ^
    105|     expect(res.body.inventory.stock_quantity).toBe(20);
    106|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/10]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > creates a new order with valid data
AssertionError: expected undefined to be 'customer@example.com' // Object.is equality

- Expected:
"customer@example.com"

+ Received:
undefined

 â¯ tests/integration/orders.routes.test.ts:73:43
     71|     expect(res.body).toHaveProperty("order");
     72|     expect(res.body.order).toHaveProperty("id");
     73|     expect(res.body.order.customer_email).toBe("customer@example.com");
       |                                           ^
     74|     expect(res.body.order.total).toBe(11.98);
     75|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/10]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > validates required customer fields
AssertionError: expected 'customer: Required' to contain 'email'

Expected: "email"
Received: "customer: Required"

 â¯ tests/integration/orders.routes.test.ts:101:28
     99|
    100|     expect(res.body).toHaveProperty("error");
    101|     expect(res.body.error).toContain("email");
       |                            ^
    102|   });
    103|

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/10]â¯

 FAIL  tests/integration/orders.routes.test.ts > POST /api/orders > handles transaction rollback on inventory update failure
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ tests/integration/orders.routes.test.ts:195:8
    193|       .post("/api/orders")
    194|       .send(orderData)
    195|       .expect(400);
       |        ^
    196|
    197|     expect(res.body).toHaveProperty("error");
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:138:14
 â¯ Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:152:11

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/10]â¯

 Test Files  3 failed | 8 passed (11)
      Tests  10 failed | 108 passed (118)
   Start at  07:57:32
   Duration  29.24s (transform 748ms, setup 0ms, collect 6.60s, tests 116.56s, environment 2ms, prepare 1.66s)

 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
