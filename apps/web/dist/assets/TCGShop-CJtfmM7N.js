const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VirtualCardGrid-BGrpzZSe.js","assets/index-DpUM0y5P.js","assets/CurrencySelector-C6moJEjC.js"])))=>i.map(i=>d[i]);
import{c as le,r as n,j as e,X as ie,_ as Le,g as Xe,R as ve,u as Je,E as Pe}from"./index-DpUM0y5P.js";import{S as Ve,R as et,M as Oe,a as tt,C as st,b as qe,F as rt,c as at,P as nt}from"./CurrencySelector-C6moJEjC.js";import{U as lt,C as ae,A as ne}from"./api-CyDFYEMM.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],it=le("arrow-left",ot);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],dt=le("credit-card",ct);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],ut=le("keyboard",mt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],De=le("layout-grid",ht);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],gt=le("list",xt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"M5 12h14",key:"1ays0h"}]],pt=le("minus",ft);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],yt=le("phone",bt),Fe=({searchTerm:a,onSearchChange:i,selectedGame:r,onGameChange:l,selectedSet:m,onSetChange:$,games:x=[],sets:O=[],additionalFilters:q={},apiUrl:E,showAutocomplete:L=!0,debounceMs:P=300,minSearchLength:F=2,placeholder:_="Search by name, number, or set..."})=>{const[I,T]=n.useState([]),[v,s]=n.useState(!1),[f,j]=n.useState(-1),[k,N]=n.useState(!1),R=n.useRef(null),M=n.useRef(null),z=n.useRef(null);n.useEffect(()=>()=>{M.current&&clearTimeout(M.current),R.current&&R.current.abort()},[]);const D=n.useCallback(c=>{M.current&&clearTimeout(M.current),R.current&&R.current.abort(),c.length>=F?(N(!0),M.current=setTimeout(async()=>{var b;if(i(c),L&&E)try{R.current=new AbortController;const S=await fetch(`${E}/search/autocomplete?q=${encodeURIComponent(c)}`,{signal:R.current.signal,credentials:"include"});if(S.ok){const C=await S.json();T(C.suggestions??[]),s((((b=C.suggestions)==null?void 0:b.length)??0)>0),j(-1)}else T([]),s(!1)}catch(S){S instanceof DOMException&&S.name==="AbortError"||console.error("Autocomplete error:",S)}finally{N(!1)}else N(!1)},P)):(c.length===0&&i(""),T([]),s(!1),N(!1))},[i,E,L,P,F]),U=n.useCallback(c=>{var b;i(c.name),s(!1),T([]),(b=z.current)==null||b.focus()},[i]),u=n.useCallback(c=>{if(!(!v||I.length===0))switch(c.key){case"ArrowDown":c.preventDefault(),j(b=>b<I.length-1?b+1:0);break;case"ArrowUp":c.preventDefault(),j(b=>b>0?b-1:I.length-1);break;case"Enter":c.preventDefault(),f>=0&&U(I[f]);break;case"Escape":s(!1);break}},[v,I,f,U]),p=n.useCallback(()=>{i(""),T([]),s(!1),z.current&&(z.current.value="",z.current.focus())},[i]),y="search-suggestions";return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"}),k&&e.jsx(et,{className:"absolute right-10 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500 animate-spin","aria-hidden":"true"}),a&&e.jsx("button",{type:"button",onClick:p,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-600 rounded","aria-label":"Clear search",children:e.jsx(ie,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsx("input",{ref:z,type:"text",placeholder:_,defaultValue:a,onChange:c=>D(c.target.value),onFocus:()=>s(I.length>0),onBlur:c=>{const b=c.relatedTarget;(!b||!b.closest(`#${y}`))&&setTimeout(()=>s(!1),150)},onKeyDown:u,"aria-autocomplete":"list","aria-controls":v?y:void 0,"aria-activedescendant":v&&f>=0?`${y}-option-${f}`:void 0,className:"w-full pl-10 pr-10 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:k?"Loading suggestions":""}),v&&I.length>0&&e.jsx("div",{id:y,role:"listbox",className:"absolute z-50 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-96 overflow-y-auto",children:I.map((c,b)=>e.jsx("button",{id:`${y}-option-${b}`,role:"option","aria-selected":b===f,type:"button",onClick:()=>U(c),className:`w-full text-left px-4 py-2 hover:bg-blue-50 border-b border-slate-100 last:border-b-0 ${b===f?"bg-blue-50":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-slate-900 truncate",children:c.name}),e.jsxs("div",{className:"text-sm text-slate-500 flex items-center gap-2",children:[c.set_name&&e.jsx("span",{children:c.set_name}),c.card_number?e.jsxs(e.Fragment,{children:[e.jsx("span",{"aria-hidden":!0,children:"•"}),e.jsxs("span",{children:["#",String(c.card_number)]})]}):null]})]}),c.image_url?e.jsx("img",{src:c.image_url,alt:c.name,className:"w-12 h-16 object-cover rounded ml-2 flex-shrink-0",onError:S=>{const C=S.currentTarget;C.alt="",C.style.display="none"}}):null]})},`${c.id}-${b}`))})]}),e.jsxs("select",{value:r,onChange:c=>l(c.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","aria-label":"Filter by game",children:[e.jsx("option",{value:"all",children:"All Games"}),x.map(c=>e.jsxs("option",{value:c.name,children:[c.name,c.card_count&&c.card_count>0?` (${c.card_count})`:""]},c.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:m,onChange:c=>$(c.target.value),disabled:r==="all",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-100 disabled:cursor-not-allowed","aria-label":"Filter by set",children:[e.jsx("option",{value:"all",children:r==="all"?"Select a game first":"All Sets"}),O.map(c=>e.jsxs("option",{value:c.name,children:[c.name,c.card_count&&c.card_count>0?` (${c.card_count})`:""]},c.id))]}),r==="all"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select a game to filter by set"})]}),Object.entries(q).map(([c,b])=>{var S;return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 mb-1",htmlFor:`filter-${c}`,children:b.label??c}),e.jsxs("select",{id:`filter-${c}`,value:b.value,onChange:C=>b.onChange(C.target.value),disabled:!!b.disabled,className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"all",children:b.label??c}),(S=b.options)==null?void 0:S.map(C=>e.jsx("option",{value:C.value,children:C.label},C.value))]})]},c)})]})},jt=(a,i="all")=>{const[r,l]=n.useState([]),[m,$]=n.useState([]),[x,O]=n.useState({treatments:[],rarities:[],qualities:[],foilTypes:[],languages:[]}),[q,E]=n.useState(!0),[L,P]=n.useState(null),F=n.useCallback(s=>({"Magic: The Gathering":1,Pokemon:2,"Yu-Gi-Oh!":3})[s]||null,[]),_=n.useCallback(async()=>{try{const s=await fetch(`${a}/games`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch games");const f=await s.json(),j=await Promise.all((f.games||f).map(async k=>{try{const N=await fetch(`${a}/cards/count?game_id=${k.id}`,{credentials:"include"});if(N.ok){const R=await N.json();return{...k,card_count:R.count||0}}}catch{console.warn(`Failed to fetch count for ${k.name}`)}return{...k,card_count:0}}));l(j)}catch(s){console.error("Error fetching games:",s),P(s.message)}},[a]),I=n.useCallback(async()=>{if(i==="all"){$([]);return}try{const s=F(i);if(!s){$([]);return}const f=await fetch(`${a}/sets?game_id=${s}`,{credentials:"include"});if(!f.ok)throw new Error("Failed to fetch sets");const j=await f.json(),k=await Promise.all(j.map(async N=>{try{const R=await fetch(`${a}/cards/count?set_id=${N.id}`,{credentials:"include"});if(R.ok){const M=await R.json();return{...N,card_count:M.count||0}}}catch{console.warn(`Failed to fetch count for ${N.name}`)}return{...N,card_count:0}}));$(k)}catch(s){console.error("Error fetching sets:",s),P(s.message),$([])}},[a,i,F]),T=n.useCallback(async()=>{try{const s=new URLSearchParams;if(i!=="all"){const p=F(i);p&&s.append("game_id",p)}const f=await fetch(`${a}/filters/treatments?${s}`,{credentials:"include"}),j=await fetch(`${a}/filters/rarities?${s}`,{credentials:"include"}),k=await fetch(`${a}/filters/qualities?${s}`,{credentials:"include"}),N=await fetch(`${a}/filters/foil-types?${s}`,{credentials:"include"}),R=await fetch(`${a}/filters/languages?${s}`,{credentials:"include"}),[M,z,D,U,u]=await Promise.all([f.ok?f.json():[],j.ok?j.json():[],k.ok?k.json():[],N.ok?N.json():[],R.ok?R.json():[]]);O({treatments:M||[],rarities:z||[],qualities:D||[],foilTypes:U||[],languages:u||[]})}catch(s){console.error("Error fetching filter options:",s),O({treatments:[],rarities:[],qualities:[],foilTypes:[],languages:[]})}},[a,i,F]);n.useEffect(()=>{(async()=>{E(!0),P(null);try{await _(),await T()}catch(f){console.error("Error loading initial data:",f),P(f.message)}finally{E(!1)}})()},[_,T]),n.useEffect(()=>{I()},[I]),n.useEffect(()=>{T()},[T]);const v=n.useCallback(async()=>{E(!0),P(null);try{await Promise.all([_(),I(),T()])}catch(s){console.error("Error refreshing data:",s),P(s.message)}finally{E(!1)}},[_,I,T]);return{games:r,sets:m,filterOptions:x,loading:q,error:L,refresh:v}},wt=({cart:a,currency:i,onBack:r,onOrderSubmit:l})=>{const[m,$]=n.useState({firstName:"",lastName:"",email:"",phone:"",address:"",suburb:"",city:"",region:"",postalCode:"",country:"New Zealand",notes:""}),[x,O]=n.useState({}),[q,E]=n.useState(!1),[L,P]=n.useState(!1),F=a.reduce((s,f)=>s+f.price*f.quantity,0),_=(s,f="text")=>{if(typeof s!="string")return"";switch(f){case"name":return s.replace(/[<>'"&{}]/g,"").trim();case"email":return s.replace(/[<>'"&{}]/g,"").trim().toLowerCase();case"phone":return s.replace(/[^+\d\s\-()]/g,"").trim();case"address":return s.replace(/[<>'"&{}]/g,"").trim();case"notes":return s.replace(/[<>'"&{}<script>]/gi,"").trim();default:return s.replace(/[<>'"&{}]/g,"").trim()}},I=()=>{const s={},f=_(m.firstName,"name"),j=_(m.lastName,"name");f?f.length>50?s.firstName="First name is too long (max 50 characters)":/^[a-zA-Z\u00C0-\u017F\s\-'.]+$/.test(f)||(s.firstName="First name contains invalid characters"):s.firstName="First name is required",j?j.length>50?s.lastName="Last name is too long (max 50 characters)":/^[a-zA-Z\u00C0-\u017F\s\-'.]+$/.test(j)||(s.lastName="Last name contains invalid characters"):s.lastName="Last name is required";const k=_(m.email,"email");k?k.length>254?s.email="Email address is too long":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)||(s.email="Please enter a valid email address"):s.email="Email is required";const N=_(m.phone,"phone");N&&!/^[+]?[\d\s\-()]{7,20}$/.test(N)&&(s.phone="Please enter a valid phone number");const R=_(m.address,"address");R?R.length>200&&(s.address="Address is too long (max 200 characters)"):s.address="Address is required";const M=_(m.city,"name");M?M.length>100&&(s.city="City name is too long (max 100 characters)"):s.city="City is required";const z=_(m.postalCode);return z?/^[A-Z0-9\s-]{3,10}$/i.test(z)||(s.postalCode="Please enter a valid postal code"):s.postalCode="Postal code is required",_(m.notes,"notes").length>500&&(s.notes="Notes are too long (max 500 characters)"),O(s),Object.keys(s).length===0},T=(s,f)=>{let j=f;const k={firstName:"name",lastName:"name",email:"email",phone:"phone",address:"address",city:"name",notes:"notes"};k[s]&&(j=_(f,k[s])),$(N=>({...N,[s]:j})),x[s]&&O(N=>({...N,[s]:""}))},v=async s=>{if(s.preventDefault(),!!I()){E(!0);try{const j={customer:{firstName:_(m.firstName,"name"),lastName:_(m.lastName,"name"),email:_(m.email,"email"),phone:_(m.phone,"phone"),address:_(m.address,"address"),suburb:_(m.suburb,"address"),city:_(m.city,"name"),region:_(m.region,"name"),postalCode:_(m.postalCode),country:_(m.country,"name"),notes:_(m.notes,"notes")},items:a.map(k=>({inventory_id:k.inventory_id||k.id,quantity:Math.max(1,Math.min(50,parseInt(k.quantity)||1)),price:Math.max(0,parseFloat(k.price)||0)})),total:Math.max(0,parseFloat(F)||0),currency:i.code||"NZD",timestamp:new Date().toISOString()};l&&await l(j),P(!0)}catch{O({submit:"Failed to submit order. Please try again."})}finally{E(!1)}}};return L?e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-2",children:"Order Submitted!"}),e.jsxs("p",{className:"text-slate-600 mb-6",children:["Thank you for your order! We've sent a confirmation email to"," ",e.jsx("span",{className:"font-medium",children:m.email})," and will be in touch shortly to confirm your order and provide payment details."]}),e.jsx("button",{onClick:r,className:"w-full px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors",children:"Continue Shopping"})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-4",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-slate-600 hover:text-slate-800 transition-colors",children:[e.jsx(it,{className:"w-5 h-5"}),"Back to Cart"]}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 mt-2",children:"Checkout"})]})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 py-8",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Customer Details"}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-slate-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",id:"firstName",value:m.firstName,onChange:s=>T("firstName",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.firstName?"border-red-500":"border-slate-300"}`,placeholder:"John"}),"// @ts-expect-error TS(2339): Property 'firstName' does not exist on type '","'.",x.firstName&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'firstName' does not exist on type '","'.",x.firstName]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-slate-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",id:"lastName",value:m.lastName,onChange:s=>T("lastName",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.lastName?"border-red-500":"border-slate-300"}`,placeholder:"Smith"}),"// @ts-expect-error TS(2339): Property 'lastName' does not exist on type '","'.",x.lastName&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'lastName' does not exist on type '","'.",x.lastName]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-slate-700 mb-1",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"email",id:"email",value:m.email,onChange:s=>T("email",s.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.email?"border-red-500":"border-slate-300"}`,placeholder:"john@example.com"})]}),"// @ts-expect-error TS(2339): Property 'email' does not exist on type '","'.",x.email&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'email' does not exist on type '","'.",x.email]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-slate-700 mb-1",children:"Phone Number (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(yt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"tel",id:"phone",value:m.phone,onChange:s=>T("phone",s.target.value),className:`w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.phone?"border-red-500":"border-slate-300"}`,placeholder:"+64 21 123 4567"})]}),"// @ts-expect-error TS(2339): Property 'phone' does not exist on type '","'.",x.phone&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'phone' does not exist on type '","'.",x.phone]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),"Shipping Address"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-slate-700 mb-1",children:"Address *"}),e.jsx("input",{type:"text",id:"address",value:m.address,onChange:s=>T("address",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.address?"border-red-500":"border-slate-300"}`,placeholder:"123 Main Street"}),"// @ts-expect-error TS(2339): Property 'address' does not exist on type '","'.",x.address&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'address' does not exist on type '","'.",x.address]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"suburb",className:"block text-sm font-medium text-slate-700 mb-1",children:"Suburb (optional)"}),e.jsx("input",{type:"text",id:"suburb",value:m.suburb,onChange:s=>T("suburb",s.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"Ponsonby"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"region",className:"block text-sm font-medium text-slate-700 mb-1",children:"Region (optional)"}),e.jsx("input",{type:"text",id:"region",value:m.region,onChange:s=>T("region",s.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"Auckland Region"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-slate-700 mb-1",children:"City *"}),e.jsx("input",{type:"text",id:"city",value:m.city,onChange:s=>T("city",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.city?"border-red-500":"border-slate-300"}`,placeholder:"Auckland"}),"// @ts-expect-error TS(2339): Property 'city' does not exist on type '","'.",x.city&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'city' does not exist on type '","'.",x.city]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-slate-700 mb-1",children:"Postal Code *"}),e.jsx("input",{type:"text",id:"postalCode",value:m.postalCode,onChange:s=>T("postalCode",s.target.value),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none ${x.postalCode?"border-red-500":"border-slate-300"}`,placeholder:"1010"}),"// @ts-expect-error TS(2339): Property 'postalCode' does not exist on type '","'.",x.postalCode&&e.jsxs("p",{className:"text-sm text-red-600 mt-1 flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),"// @ts-expect-error TS(2339): Property 'postalCode' does not exist on type '","'.",x.postalCode]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-slate-700 mb-1",children:"Country"}),e.jsxs("select",{id:"country",value:m.country,onChange:s=>T("country",s.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none",children:[e.jsx("option",{value:"New Zealand",children:"New Zealand"}),e.jsx("option",{value:"Australia",children:"Australia"}),e.jsx("option",{value:"United States",children:"United States"}),e.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),e.jsx("option",{value:"Canada",children:"Canada"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-slate-700 mb-1",children:"Order Notes (Optional)"}),e.jsx("textarea",{id:"notes",value:m.notes,onChange:s=>T("notes",s.target.value),rows:3,className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none",placeholder:"Any special instructions or notes..."})]}),e.jsx("div",{className:"pt-6",children:e.jsx("button",{type:"submit",disabled:q,className:"w-full px-6 py-4 bg-green-600 hover:bg-green-700 disabled:bg-green-400 text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2",children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-5 h-5"}),"Submit Order"]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-slate-200 h-fit",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-6",children:"Order Summary"}),e.jsx("div",{className:"space-y-4 mb-6",children:a.map(s=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-16 h-20 object-contain rounded bg-slate-100",onError:f=>{f.target.style.display="none"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm text-slate-900 line-clamp-2",children:s.name}),e.jsxs("div",{className:"text-xs text-slate-600 mt-1 space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-800",children:s.game_name}),e.jsxs("div",{children:[s.set_name," #",s.card_number]}),s.rarity&&e.jsx("div",{className:"text-slate-500",children:s.rarity}),e.jsx("div",{children:s.quality}),s.foil_type&&s.foil_type!=="Regular"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"✨"}),e.jsx("span",{className:"font-medium text-yellow-600",children:s.foil_type})]}),s.language&&s.language!=="English"&&e.jsx("div",{className:"font-medium text-slate-700",children:s.language})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-xs text-slate-600",children:["Qty: ",s.quantity]}),e.jsxs("span",{className:"font-semibold text-slate-900",children:[i.symbol,(s.price*s.quantity).toFixed(2)]})]})]})]},`${s.id}-${s.quality}`))}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:[i.symbol,F.toFixed(2)]})]}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"Payment Process"}),e.jsxs("p",{className:"text-sm text-blue-800",children:["After submitting your order, we'll send you an email with bank account details for fund transfer",m.country!=="New Zealand"?" or alternative payment methods for overseas customers":"",". Your cards will be reserved and shipped once payment is received."]})]})]})]})]})})]})},Nt={DEBOUNCE_DELAY:300},vt={INITIAL_BATCH_SIZE:100},Ie={MIN_TOUCH_TARGET:44},ee={CLIENT_ERROR_RANGE:[400,499],SERVER_ERROR_RANGE:[500,599],HTTP_STATUS:{UNAUTHORIZED:401,FORBIDDEN:403,BAD_REQUEST:400,UNPROCESSABLE_ENTITY:422,INTERNAL_SERVER_ERROR:500},DEFAULT_MAX_RETRIES:3,DEFAULT_RETRY_DELAY:1e3},G={data:null,timestamp:null,filters:null},kt=5*60*1e3,Ct=Nt.DEBOUNCE_DELAY,_t=2,St=2e3,Et=(a,i={})=>{const[r,l]=n.useState(G.data||{}),[m,$]=n.useState(!1),[x,O]=n.useState(null),q=n.useRef(null),E=n.useRef(null),L=n.useRef(0),P=n.useCallback(()=>{if(!G.data||!G.timestamp)return!1;const v=Date.now()-G.timestamp,s=G.filters||{},f=Object.keys(i).length===Object.keys(s).length&&Object.entries(i).every(([j,k])=>s[j]===k);return v<kt&&f},[i]),F=n.useCallback(async(v={},s=0)=>{const f=Date.now();if(!(f-L.current<1e3)){L.current=f,E.current&&E.current.abort(),E.current=new AbortController,$(!0),O(null);try{const j=new URLSearchParams;Object.entries(v).forEach(([R,M])=>{M&&M!=="all"&&j.append(R,String(M))});const k=await fetch(`${a}/filters/counts?${j}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:E.current.signal});if(k.status===429){if(s<_t)return await new Promise(R=>setTimeout(R,St*Math.pow(2,s))),F(v,s+1);throw new Error("Rate limit exceeded. Using cached data.")}if(!k.ok)throw new Error(`API error: ${k.status}`);const N=await k.json();G.data=N,G.timestamp=Date.now(),G.filters=v,l(N),O(null)}catch(j){if(j.name==="AbortError")return;O(j.message),G.data?l(G.data):l({rarities:{},qualities:{},games:{},sets:{},foilTypes:{}})}finally{$(!1)}}},[a]);n.useEffect(()=>{if(P()){l(G.data);return}return q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{F(i)},Ct),()=>{q.current&&clearTimeout(q.current),E.current&&E.current.abort()}},[i,F,P]);const _=v=>!v||v===0?"":v<1e3?`(${v})`:v<1e6?`(${(v/1e3).toFixed(1)}k)`:`(${(v/1e6).toFixed(1)}M)`;return{filterCounts:r,isLoading:m,error:x,getCount:(v,s)=>{const f=r[v];return f?_(f[s]||0):""},getOptionsWithCounts:(v,s)=>{const f=r[v]||{};return s.map(j=>({...j,count:f[j.value]||0,displayCount:_(f[j.value]||0)})).filter(j=>j.count>0)},refreshCounts:()=>{G.data=null,G.timestamp=null,F(i)}}},Tt=a=>{const[i,r]=n.useState([]),[l,m]=n.useState([]),[$,x]=n.useState(!0),O=7,q="tcg_cart_v1",E="tcg_cart_key_2024",L=n.useRef(0),P=n.useRef(!1),F=n.useCallback(u=>{try{const p=JSON.stringify(u);let y="";for(let c=0;c<p.length;c++)y+=String.fromCharCode(p.charCodeAt(c)^E.charCodeAt(c%E.length));return btoa(y)}catch{return null}},[]),_=n.useCallback(u=>{try{const p=atob(u);let y="";for(let c=0;c<p.length;c++)y+=String.fromCharCode(p.charCodeAt(c)^E.charCodeAt(c%E.length));return JSON.parse(y)}catch{return null}},[]),I=n.useCallback(u=>{try{const p={items:u,timestamp:Date.now(),version:L.current},y=F(p);y&&localStorage.setItem(q,y)}catch{}},[F]),T=n.useCallback(()=>{try{const u=localStorage.getItem(q);if(!u)return[];const p=_(u);if(!p||!p.items)return[];const y=Date.now()-(p.timestamp||0),c=O*24*60*60*1e3;return y>c?(localStorage.removeItem(q),[]):(L.current=Math.max(L.current,p.version||0),p.items||[])}catch{return localStorage.removeItem(q),[]}},[_]),v=n.useCallback((u,p="info",y=5e3)=>{const c={id:Date.now()+Math.random(),message:u,type:p,timestamp:Date.now()};m(b=>[...b,c]),setTimeout(()=>{m(b=>b.filter(S=>S.id!==c.id))},y)},[]),s=n.useRef(null);s.current=v,n.useEffect(()=>{(async()=>{x(!0);try{const p=T();p.length>0&&(r(p),await new Promise(y=>setTimeout(y,100)))}catch{}finally{x(!1)}})()},[T]),n.useEffect(()=>{!$&&i.length>=0&&I(i)},[i,$,I]);const f=n.useCallback(async u=>{try{const p=await fetch(`${a}/cards/${u.id}/current-price`);if(!p.ok)return u;const{price:y}=await p.json();return Math.abs(y-u.price)/u.price>.05?{...u,originalPrice:u.price,currentPrice:y,priceChanged:!0}:u}catch{return u}},[a]),j=n.useCallback(async()=>{var u;if(i.length!==0)try{const p=await Promise.all(i.map(c=>f(c))),y=p.filter(c=>c.priceChanged);y.length>0&&(s.current&&((u=s.current)==null||u.call(s,`Price changes detected for ${y.length} item(s). Please review your cart.`,"warning",1e4)),r(p))}catch{}},[i,f]),k=n.useCallback(async()=>{var u;if(i.length!==0)try{const p=await Promise.all(i.map(async c=>{const b=await fetch(`${a}/cards/${c.id}/stock`);if(!b.ok)return c;const{stock:S}=await b.json();return{...c,currentStock:S,outOfStock:S<c.quantity}})),y=p.filter(c=>c.outOfStock);y.length>0&&(s.current&&((u=s.current)==null||u.call(s,`${y.length} item(s) in your cart are now out of stock.`,"error",1e4)),r(p))}catch{}},[i,a]),N=n.useCallback(u=>{var p,y,c,b,S;if(P.current){s.current&&((p=s.current)==null||p.call(s,"Please wait - cart operation in progress","info",2e3));return}P.current=!0;try{if(!u||!u.id||!u.name||!u.price){s.current&&((y=s.current)==null||y.call(s,"Invalid item - cannot add to cart","error"));return}if(u.stock<=0){s.current&&((c=s.current)==null||c.call(s,`${u.name} is out of stock`,"error"));return}r(C=>{var ce,X;L.current+=1;const Y=L.current,te=C.findIndex(Z=>Z.id===u.id&&Z.quality===u.quality);let se;if(te>=0){const Z=C[te];if(Z.version>Y-2){if(Z.quantity>=u.stock)return s.current&&((ce=s.current)==null||ce.call(s,`Cannot add more - only ${u.stock} in stock`,"warning")),C;se=[...C],se[te]={...se[te],quantity:Math.min(Z.quantity+1,u.stock),version:Y,lastModified:Date.now()}}else return s.current&&((X=s.current)==null||X.call(s,"Cart updated by another action - please try again","warning")),C}else se=[...C,{...u,quantity:1,addedAt:Date.now(),version:Y,lastModified:Date.now()}];return se}),s.current&&((b=s.current)==null||b.call(s,`Added ${u.name} to cart`,"success",3e3))}catch{s.current&&((S=s.current)==null||S.call(s,"Failed to add item to cart. Please try again.","error"))}finally{setTimeout(()=>{P.current=!1},300)}},[]),R=n.useCallback((u,p)=>{r(y=>{var b;const c=y.filter(S=>!(S.id===u&&S.quality===p));return c.length!==y.length&&s.current&&((b=s.current)==null||b.call(s,"Item removed from cart","info",2e3)),c})},[]),M=n.useCallback((u,p,y)=>{var c;if(y<=0){R(u,p);return}if(P.current){s.current&&((c=s.current)==null||c.call(s,"Please wait - cart operation in progress","info",2e3));return}P.current=!0;try{r(b=>{L.current+=1;const S=L.current;return b.map(C=>{var Y;return C.id===u&&C.quality===p?C.version&&C.version<S-2?(s.current&&((Y=s.current)==null||Y.call(s,"Item was updated elsewhere - please refresh","warning")),C):{...C,quantity:y,version:S,lastModified:Date.now()}:C})})}finally{setTimeout(()=>{P.current=!1},200)}},[R]),z=n.useCallback(()=>{var u;r([]),s.current&&((u=s.current)==null||u.call(s,"Cart cleared","info",2e3))},[]),D=n.useCallback(()=>{const u=Date.now(),p=O*24*60*60*1e3;r(y=>{var b;const c=y.filter(S=>u-(S.addedAt||u)<p);if(c.length!==y.length&&s.current){const S=y.length-c.length;(b=s.current)==null||b.call(s,`Removed ${S} expired item(s) from cart`,"info",5e3)}return c})},[]),U=n.useCallback(()=>{const u=i.reduce((S,C)=>{const Y=C.priceChanged?C.currentPrice:C.price;return S+Y*C.quantity},0),p=i.reduce((S,C)=>S+C.quantity,0),y=i.length,c=i.filter(S=>S.priceChanged).length,b=i.filter(S=>S.outOfStock).length;return{total:u,itemCount:p,uniqueItems:y,priceChangedItems:c,outOfStockItems:b}},[i]);return n.useEffect(()=>{const u=setInterval(()=>{j(),k(),D()},3e5);return()=>clearInterval(u)},[j,k,D]),{cart:i,cartNotifications:l,isLoading:$,addToCart:N,updateQuantity:M,removeFromCart:R,clearCart:z,validateCart:j,checkStock:k,getCartStats:U,clearExpiredItems:D,addNotification:v}},$t=({isOpen:a,onClose:i})=>{if(!a)return null;const r=[{category:"Navigation",shortcuts:[{key:"Tab",description:"Navigate through interactive elements"},{key:"Shift + Tab",description:"Navigate backwards through elements"},{key:"Enter",description:"Activate buttons and links"},{key:"Space",description:"Activate buttons and checkboxes"},{key:"Esc",description:"Close modals and dropdowns"}]},{category:"Search",shortcuts:[{key:"/",description:"Focus search input"},{key:"↑ ↓",description:"Navigate search suggestions"},{key:"Enter",description:"Select highlighted suggestion"},{key:"Esc",description:"Close search suggestions"}]},{category:"Filters",shortcuts:[{key:"f",description:"Toggle mobile filters panel"},{key:"g",description:"Switch between grid and list view"},{key:"c",description:"Open shopping cart"},{key:"r",description:"Reset all filters"}]},{category:"Cart",shortcuts:[{key:"a",description:"Add focused item to cart"},{key:"+",description:"Increase item quantity"},{key:"-",description:"Decrease item quantity"},{key:"Delete",description:"Remove item from cart"}]},{category:"General",shortcuts:[{key:"?",description:"Show this help dialog"},{key:"Ctrl + K",description:"Quick search (command palette)"},{key:"Alt + C",description:"Change currency"}]}],l=m=>{m.target===m.currentTarget&&i()};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",onClick:l,role:"dialog","aria-labelledby":"shortcuts-title","aria-describedby":"shortcuts-description",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ut,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{id:"shortcuts-title",className:"text-xl font-bold text-slate-900",children:"Keyboard Shortcuts"}),e.jsx("p",{id:"shortcuts-description",className:"text-sm text-slate-600",children:"Use these shortcuts to navigate more efficiently"})]})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors focus:ring-4 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none","aria-label":"Close keyboard shortcuts help",children:e.jsx(ie,{className:"w-5 h-5 text-slate-600"})})]}),e.jsx("div",{className:"p-6 space-y-6",children:r.map(({category:m,shortcuts:$})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-3 flex items-center gap-2",children:m}),e.jsx("div",{className:"space-y-2",children:$.map(({key:x,description:O})=>e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg hover:bg-slate-50",children:[e.jsx("span",{className:"text-slate-700",children:O}),e.jsx("kbd",{className:"inline-flex items-center px-2 py-1 text-xs font-mono bg-slate-100 border border-slate-300 rounded-md text-slate-800 min-w-[2.5rem] justify-center",children:x})]},`${m}-${x}`))})]},m))}),e.jsx("div",{className:"p-6 border-t border-slate-200 bg-slate-50 rounded-b-xl",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-slate-900",children:"Tip:"})," Press"," ",e.jsx("kbd",{className:"px-1.5 py-0.5 text-xs bg-slate-200 border border-slate-300 rounded font-mono",children:"?"})," ","anytime to open this help dialog"]}),e.jsx("button",{onClick:i,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors focus:ring-4 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none",children:"Got it!"})]})})]})})},Q={NETWORK:"NETWORK",AUTH:"AUTH",VALIDATION:"VALIDATION",API:"API",UNKNOWN:"UNKNOWN"},Rt={[Q.NETWORK]:{title:"Connection Error",message:"Please check your internet connection and try again.",action:"Retry"},[Q.AUTH]:{title:"Authentication Error",message:"Your session has expired. Please log in again.",action:"Login"},[Q.VALIDATION]:{title:"Validation Error",message:"Please check your input and try again.",action:"Fix"},[Q.API]:{title:"Server Error",message:"Something went wrong on our end. Please try again later.",action:"Retry"},[Q.UNKNOWN]:{title:"Unexpected Error",message:"An unexpected error occurred. Please try again.",action:"Retry"}},At=a=>!navigator.onLine||a.name==="TypeError"&&a.message.includes("fetch")?Q.NETWORK:a.status===ee.HTTP_STATUS.UNAUTHORIZED||a.status===ee.HTTP_STATUS.FORBIDDEN?Q.AUTH:a.status===ee.HTTP_STATUS.BAD_REQUEST||a.status===ee.HTTP_STATUS.UNPROCESSABLE_ENTITY?Q.VALIDATION:a.status>=ee.HTTP_STATUS.INTERNAL_SERVER_ERROR||a.status>=ee.CLIENT_ERROR_RANGE[0]&&a.status<ee.SERVER_ERROR_RANGE[0]?Q.API:Q.UNKNOWN,Pt=(a,i=null)=>{const r=At(a),l=Rt[r];return{type:r,title:l.title,message:i||a.message||l.message,action:l.action,originalError:a,timestamp:new Date().toISOString()}},xe=(a,i={})=>Pt(a),Ot=async(a,i={})=>{let r={status:a.status,statusText:a.statusText};try{const m=await a.json();r={...r,...m}}catch{r.message=a.statusText||`HTTP ${a.status}`}const l=new Error(r.message||r.error||`HTTP ${a.status}`);return l.status=a.status,l.response=a,xe(l,i)},qt=()=>{const a=(r,l={})=>xe(r,l);return{handleError:a,handleApiCall:async(r,l={})=>{try{const m=await r();if(!m.ok)throw await Ot(m,l);return m}catch(m){throw a(m,l)}}}},Ft=async(a,i=ee.DEFAULT_MAX_RETRIES,r=ee.DEFAULT_RETRY_DELAY)=>{let l;for(let m=1;m<=i;m++)try{return await a()}catch($){if(l=$,$.status===429)throw xe($,{operation:a.name||"anonymous"});if(m===i)throw xe($,{operation:a.name||"anonymous"});await new Promise(x=>setTimeout(x,r*Math.pow(2,m-1)))}throw l},It=async(a,i={})=>{const r=(await Le(async()=>{const{default:l}=await import("./requestThrottler-CPgOJH9g.js");return{default:l}},[])).default;try{return await r.fetch(a,i)}catch(l){throw l.response&&(l.status=l.response.status),l}},Lt=()=>e.jsxs("div",{className:"card-mm flex flex-row lg:flex-col h-full animate-pulse",children:[e.jsx("div",{className:"relative flex-shrink-0 w-28 sm:w-36 lg:w-full",children:e.jsx("div",{className:"w-full h-32 sm:h-44 lg:h-64 bg-mm-warmAccent"})}),e.jsxs("div",{className:"p-4 sm:p-5 lg:p-5 flex flex-col gap-3 lg:gap-3 flex-grow min-w-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 lg:h-5 bg-mm-warmAccent rounded w-3/4"}),e.jsx("div",{className:"h-3 lg:h-4 bg-mm-warmAccent rounded w-1/2"})]}),e.jsx("div",{className:"h-11 bg-mm-warmAccent rounded-lg"}),e.jsx("div",{className:"h-6 bg-mm-warmAccent rounded w-20"}),e.jsx("div",{className:"h-11 bg-mm-warmAccent rounded-lg"})]})]});var Me={exports:{}},Dt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Mt=Dt,Ut=Mt;function Ue(){}function Ke(){}Ke.resetWarningCache=Ue;var Kt=function(){function a(l,m,$,x,O,q){if(q!==Ut){var E=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw E.name="Invariant Violation",E}}a.isRequired=a;function i(){return a}var r={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:i,element:a,elementType:a,instanceOf:i,node:a,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:Ke,resetWarningCache:Ue};return r.PropTypes=r,r};Me.exports=Kt();var zt=Me.exports;const h=Xe(zt),ge=({title:a,count:i,isGrid:r=!1})=>e.jsx("div",{className:"section-mm-gradient mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[r&&e.jsx(De,{className:"w-5 h-5 text-mm-teal"}),e.jsx("h2",{className:"text-xl font-bold text-mm-forest",children:a}),i!==void 0&&e.jsxs("span",{className:"px-3 py-1 bg-mm-tealLight text-mm-teal text-sm font-medium rounded-full",children:[i," ",i===1?"card":"cards"]})]})});ge.propTypes={title:h.string.isRequired,count:h.number,isGrid:h.bool};ge.defaultProps={isGrid:!1};const ze=({src:a,alt:i,className:r="",width:l,height:m,sizes:$,priority:x=!1,placeholder:O="blur",blurDataURL:q,onLoad:E,onError:L,...P})=>{const[F,_]=n.useState(!0),[I,T]=n.useState(!1),[v,s]=n.useState(""),f=n.useRef(null),j=n.useRef(null),k=n.useCallback((D=10,U=10)=>q||`data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="${D}" height="${U}"%3E%3Crect fill="%23f1f5f9" width="${D}" height="${U}"/%3E%3C/svg%3E`,[q]),N=n.useCallback(D=>D?[400,600,800,1200].map(u=>`${D}?w=${u} ${u}w`).join(", "):"",[]);n.useEffect(()=>{if(!(!f.current||x))return j.current=new IntersectionObserver(D=>{var u;const[U]=D;U.isIntersecting&&(s(a),(u=j.current)==null||u.disconnect())},{rootMargin:"50px",threshold:.1}),j.current.observe(f.current),()=>{var D;(D=j.current)==null||D.disconnect()}},[a,x]),n.useEffect(()=>{x&&s(a)},[a,x]);const R=n.useCallback(()=>{_(!1),E==null||E()},[E]),M=n.useCallback(D=>{T(!0),_(!1);const U=`data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="${l||250}" height="${m||350}"%3E%3Crect fill="%231e293b" width="100%25" height="100%25"/%3E%3Ctext fill="white" x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="14"%3ENo Image%3C/text%3E%3C/svg%3E`;D.target.src=U,L==null||L(D)},[l,m,L]),z=l&&m?`${l}/${m}`:"5/7";return e.jsxs("div",{className:`relative overflow-hidden ${r}`,style:{aspectRatio:z,backgroundColor:"#f1f5f9"},children:[F&&O==="blur"&&e.jsx("img",{src:k(l,m),alt:"",className:"absolute inset-0 w-full h-full object-cover filter blur-sm scale-110 transition-opacity duration-300","aria-hidden":"true"}),F&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-100",children:e.jsx("div",{className:"w-6 h-6 border-2 border-slate-300 border-t-blue-600 rounded-full animate-spin"})}),e.jsx("img",{ref:f,src:v,srcSet:v?N(v):void 0,sizes:$||"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, (max-width: 1280px) 33vw, 25vw",alt:i,width:l,height:m,onLoad:R,onError:M,className:`absolute inset-0 w-full h-full object-contain transition-opacity duration-500 ${F?"opacity-0":"opacity-100"} hover:scale-105 motion-reduce:hover:scale-100 motion-reduce:transition-none`,loading:x?"eager":"lazy",...P}),!F&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-transparent via-transparent to-transparent opacity-0 hover:opacity-5 transition-opacity duration-300 motion-reduce:opacity-0 pointer-events-none"}),I&&e.jsx("div",{className:"absolute bottom-2 left-2 right-2 text-xs text-white bg-red-600/80 rounded px-2 py-1",children:"Failed to load image"})]})},fe=ve.memo(({card:a,selectedVariationKey:i,selectedVariation:r,currency:l,onVariationChange:m,onAddToCart:$})=>e.jsxs("div",{className:"card-mm flex flex-row lg:flex-col h-full",children:[e.jsxs("div",{className:"relative flex-shrink-0 w-28 sm:w-36 lg:w-full",children:[e.jsx(ze,{src:a.image_url,alt:`${a.name} from ${a.set_name}`,width:250,height:350,className:`w-full h-32 sm:h-44 lg:h-64 object-cover bg-gradient-to-br from-mm-warmAccent to-mm-tealLight ${(r==null?void 0:r.foil_type)!=="Regular"?"ring-2 ring-yellow-400 ring-offset-2 shadow-yellow-200/50 shadow-lg":""}`,placeholder:"blur",sizes:"(max-width: 640px) 128px, (max-width: 1024px) 192px, 100%"}),(r==null?void 0:r.foil_type)!=="Regular"&&e.jsxs("div",{className:"absolute top-1 left-1 lg:top-2 lg:left-2 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white text-xs font-bold px-1.5 py-0.5 lg:px-2 lg:py-1 rounded-mm-sm shadow-md border border-yellow-300",children:["✨ ",r.foil_type]})]}),e.jsxs("div",{className:"p-4 sm:p-5 lg:p-5 flex flex-col gap-3 lg:gap-3 flex-grow min-w-0",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-sm lg:text-lg leading-tight text-mm-darkForest mb-1 lg:mb-2 line-clamp-2",children:a.name}),e.jsxs("p",{className:"text-xs lg:text-sm text-mm-teal pb-2 lg:pb-3 border-b border-mm-warmAccent",children:[a.set_name," • #",a.card_number]})]}),e.jsxs("div",{className:"space-y-1 lg:space-y-2 flex-shrink-0",children:[e.jsx("label",{htmlFor:`condition-${a.id}`,className:"block text-xs font-semibold text-mm-forest uppercase tracking-wide",children:"Condition"}),e.jsx("select",{id:`condition-${a.id}`,value:i,onChange:m,className:"input-mm w-full text-sm lg:text-sm",style:{minHeight:`${Ie.MIN_TOUCH_TARGET}px`},children:a.variations.map(x=>e.jsxs("option",{value:x.variation_key,children:[x.quality,x.foil_type!=="Regular"?" ✨":"",x.language!=="English"?` • ${x.language}`:""]},`${a.id}-${x.variation_key}`))})]}),e.jsx("div",{className:"flex items-center gap-2 pb-2 lg:pb-3 border-b border-mm-warmAccent flex-shrink-0",children:(r==null?void 0:r.stock)>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1.5 lg:w-2 h-1.5 lg:h-2 rounded-full bg-emerald-500"}),e.jsxs("span",{className:"text-xs lg:text-sm font-medium text-emerald-700",children:[r.stock," left"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1.5 lg:w-2 h-1.5 lg:h-2 rounded-full bg-mm-teal"}),e.jsx("span",{className:"text-xs lg:text-sm font-medium text-mm-teal",children:"Out of stock"})]})}),e.jsxs("div",{className:"mt-auto pt-1 lg:pt-2",children:[e.jsxs("div",{className:"mb-2 lg:mb-3",children:[e.jsxs("div",{className:"text-lg lg:text-2xl font-bold text-mm-darkForest leading-none mb-1",children:[l.symbol,((r==null?void 0:r.price)*l.rate).toFixed(2)]}),(r==null?void 0:r.stock)<=3&&(r==null?void 0:r.stock)>0&&e.jsxs("div",{className:"text-xs font-semibold text-red-600",children:["Only ",r.stock," left!"]})]}),e.jsx("button",{onClick:$,disabled:!r||r.stock===0,className:"btn-mm-primary w-full text-sm lg:text-base disabled:bg-mm-teal disabled:cursor-not-allowed disabled:shadow-none",style:{minHeight:`${Ie.MIN_TOUCH_TARGET}px`},"aria-label":`Add ${a.name} to cart`,children:"Add to Cart"})]})]})]}),(a,i)=>{const r=a.selectedVariation,l=i.selectedVariation;return a.card.id===i.card.id&&a.selectedVariationKey===i.selectedVariationKey&&a.currency.symbol===i.currency.symbol&&a.currency.rate===i.currency.rate&&(r==null?void 0:r.id)===(l==null?void 0:l.id)&&(r==null?void 0:r.price)===(l==null?void 0:l.price)&&(r==null?void 0:r.stock)===(l==null?void 0:l.stock)&&(r==null?void 0:r.quality)===(l==null?void 0:l.quality)&&(r==null?void 0:r.foil_type)===(l==null?void 0:l.foil_type)&&(r==null?void 0:r.language)===(l==null?void 0:l.language)});fe.displayName="CardItem";fe.propTypes={card:h.shape({id:h.oneOfType([h.string,h.number]).isRequired,name:h.string.isRequired,image_url:h.string.isRequired,set_name:h.string.isRequired,card_number:h.string,variations:h.arrayOf(h.shape({variation_key:h.string.isRequired,quality:h.string.isRequired,foil_type:h.string,language:h.string,price:h.number.isRequired,stock:h.number.isRequired})).isRequired}).isRequired,selectedVariationKey:h.string.isRequired,selectedVariation:h.shape({id:h.oneOfType([h.string,h.number]),price:h.number,stock:h.number,quality:h.string,foil_type:h.string,language:h.string}),currency:h.shape({symbol:h.string.isRequired,rate:h.number.isRequired}).isRequired,onVariationChange:h.func.isRequired,onAddToCart:h.func.isRequired};const ke=ve.memo(({card:a,selectedVariationKey:i,selectedVariation:r,currency:l,onVariationChange:m,onAddToCart:$})=>e.jsxs("div",{className:"card-mm",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-3 sm:p-4",children:[e.jsx("div",{className:"relative w-12 h-16 sm:w-16 sm:h-24 flex-shrink-0",children:e.jsx(ze,{src:a.image_url,alt:`${a.name} from ${a.set_name}`,width:80,height:112,className:"bg-gradient-to-br from-mm-warmAccent to-mm-tealLight w-full h-full object-cover rounded-mm-sm",placeholder:"blur",sizes:"80px"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm sm:text-base text-mm-darkForest truncate mb-0.5",children:a.name}),e.jsxs("p",{className:"text-xs text-mm-teal truncate",children:[a.set_name," • #",a.card_number]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 sm:hidden",children:[e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${(r==null?void 0:r.stock)>0?"bg-emerald-500":"bg-mm-teal"}`}),e.jsx("span",{className:`text-xs font-medium ${(r==null?void 0:r.stock)>0?"text-emerald-700":"text-mm-teal"}`,children:(r==null?void 0:r.stock)>0?`${r.stock} in stock`:"Out of stock"})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2 lg:gap-3 flex-shrink-0 min-w-0",children:[e.jsx("select",{id:`condition-list-${a.id}`,value:i,onChange:m,className:"input-mm flex-shrink-0 min-w-[100px] max-w-[160px] text-xs lg:text-sm px-2 py-2",children:a.variations.map(x=>e.jsxs("option",{value:x.variation_key,children:[x.quality,x.foil_type!=="Regular"?` • ${x.foil_type.slice(0,1)}`:""]},`${a.id}-${x.variation_key}`))}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0 min-w-[32px]",children:[e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${(r==null?void 0:r.stock)>0?"bg-emerald-500":"bg-mm-teal"}`}),e.jsx("span",{className:`text-xs font-medium whitespace-nowrap ${(r==null?void 0:r.stock)>0?"text-emerald-700":"text-mm-teal"}`,children:(r==null?void 0:r.stock)>0?r.stock:"0"})]}),e.jsxs("div",{className:"text-right flex-shrink-0 min-w-[60px]",children:[e.jsxs("span",{className:"text-sm lg:text-base font-bold text-mm-darkForest block leading-none whitespace-nowrap",children:[l.symbol,((r==null?void 0:r.price)*l.rate).toFixed(2)]}),(r==null?void 0:r.stock)<=3&&(r==null?void 0:r.stock)>0&&e.jsxs("span",{className:"text-xs font-semibold text-red-600 block mt-0.5 whitespace-nowrap",children:[r.stock," left"]})]}),e.jsxs("button",{onClick:$,disabled:!r||r.stock===0,className:"btn-mm-primary px-3 lg:px-4 py-2.5 text-sm min-h-[44px] flex-shrink-0 whitespace-nowrap disabled:bg-mm-teal disabled:cursor-not-allowed disabled:shadow-none","aria-label":`Add ${a.name} to cart`,children:[e.jsx("span",{className:"hidden lg:inline",children:"Add to Cart"}),e.jsx("span",{className:"lg:hidden",children:"Add"})]})]}),e.jsx("div",{className:"sm:hidden flex-shrink-0",children:e.jsx("button",{onClick:$,disabled:!r||r.stock===0,className:"btn-mm-primary px-3 py-2 text-sm min-h-[44px] whitespace-nowrap disabled:bg-mm-teal disabled:cursor-not-allowed disabled:shadow-none","aria-label":`Add ${a.name} to cart`,children:"Add"})})]}),e.jsxs("div",{className:"sm:hidden border-t border-mm-warmAccent px-3 py-2 bg-mm-tealLight",children:[e.jsx("label",{htmlFor:`condition-list-mobile-${a.id}`,className:"block text-xs font-semibold text-mm-forest uppercase tracking-wide mb-1",children:"Condition"}),e.jsx("select",{id:`condition-list-mobile-${a.id}`,value:i,onChange:m,className:"input-mm w-full text-sm px-2.5 py-2",children:a.variations.map(x=>e.jsxs("option",{value:x.variation_key,children:[x.quality,x.foil_type!=="Regular"?` • ${x.foil_type}`:""]},`${a.id}-${x.variation_key}`))})]})]}),(a,i)=>{const r=a.selectedVariation,l=i.selectedVariation;return a.card.id===i.card.id&&a.selectedVariationKey===i.selectedVariationKey&&a.currency.symbol===i.currency.symbol&&a.currency.rate===i.currency.rate&&(r==null?void 0:r.id)===(l==null?void 0:l.id)&&(r==null?void 0:r.price)===(l==null?void 0:l.price)&&(r==null?void 0:r.stock)===(l==null?void 0:l.stock)&&(r==null?void 0:r.quality)===(l==null?void 0:l.quality)&&(r==null?void 0:r.foil_type)===(l==null?void 0:l.foil_type)&&(r==null?void 0:r.language)===(l==null?void 0:l.language)});ke.displayName="ListCardItem";ke.propTypes={card:h.shape({id:h.oneOfType([h.string,h.number]).isRequired,name:h.string.isRequired,image_url:h.string.isRequired,set_name:h.string.isRequired,card_number:h.string,variations:h.arrayOf(h.shape({variation_key:h.string.isRequired,quality:h.string.isRequired,foil_type:h.string,language:h.string,price:h.number.isRequired,stock:h.number.isRequired})).isRequired}).isRequired,selectedVariationKey:h.string.isRequired,selectedVariation:h.shape({id:h.oneOfType([h.string,h.number]),price:h.number,stock:h.number,quality:h.string,foil_type:h.string,language:h.string}),currency:h.shape({symbol:h.string.isRequired,rate:h.number.isRequired}).isRequired,onVariationChange:h.func.isRequired,onAddToCart:h.func.isRequired};const Bt=ve.lazy(()=>Le(()=>import("./VirtualCardGrid-BGrpzZSe.js"),__vite__mapDeps([0,1,2]))),Wt=()=>{const[a,i]=Je(),r=a.get("search")||"",l=a.get("game")||"all",m=a.get("set")||"all",$=a.get("treatment")||"all";a.get("rarity"),a.get("quality");const x=a.get("foilType")||"all",{games:O,sets:q,filterOptions:E,loading:L,error:P}=jt(ne,l),[F,_]=n.useState(!1),[I,T]=n.useState(null),v=n.useCallback((t,o)=>{i(g=>{const d=new URLSearchParams(g);return o&&o!=="all"?d.set(t,o):d.delete(t),d})},[i]),s=n.useCallback(t=>{v("search",t)},[v]),f=n.useCallback(t=>{i(o=>{const g=new URLSearchParams(o);return t&&t!=="all"?g.set("game",t):g.delete("game"),g.delete("set"),g})},[i]),j=n.useCallback(t=>{v("set",t)},[v]),k={treatment:{value:$,onChange:t=>v("treatment",t),label:"Treatment",options:E.treatments.map(t=>({value:t.value,label:t.label,count:t.count}))},foilType:{value:x,onChange:t=>v("foilType",t),label:"Foil Type",options:E.foilTypes.map(t=>({value:t.value,label:t.label,count:t.count}))}},[N,R]=n.useState([]),M=qt(),z=n.useRef(M);z.current=M;const D=n.useCallback((t,o)=>z.current.handleError(t,o),[]),[U,u]=n.useState(!1),[p,y]=n.useState(!1),[c,b]=n.useState(!1),[S,C]=n.useState(!1),[Y,te]=n.useState({}),[se,ce]=n.useState(!navigator.onLine),[X,Z]=n.useState("grid"),pe=n.useRef({cards:!1,initialData:!1,sets:!1});n.useRef(!1);const{cart:B,cartNotifications:Ce,addToCart:_e,updateQuantity:Se,removeFromCart:Be,clearCart:Ee,addNotification:Te}=Tt(ne),be=n.useCallback((t,o="info",g=5e3)=>{Te(t,o,g)},[Te]),A=n.useMemo(()=>({quality:a.get("quality")||"all",rarity:a.get("rarity")||"all",foilType:a.get("foilType")||"all",language:a.get("language")||"English",minPrice:a.get("minPrice")||"",maxPrice:a.get("maxPrice")||"",sortBy:a.get("sortBy")||"name",sortOrder:a.get("sortOrder")||"asc",set:a.get("set")||"all"}),[a]);Et(ne,{...A,game:l});const[he,oe]=n.useState(!1),[H,He]=n.useState({symbol:"NZ$",rate:1,code:"NZD"}),ye=n.useRef(null);n.useEffect(()=>{const t=()=>{ce(!1),be("Connection restored","success")},o=()=>{ce(!0),be("You are offline. Some features may not work.","warning")};return window.addEventListener("online",t),window.addEventListener("offline",o),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",o)}},[be]),n.useEffect(()=>{te(t=>{const o=new Set(N.map(d=>d.id)),g={};return Object.keys(t).forEach(d=>{o.has(d)&&(g[d]=t[d])}),g})},[N,r,l,A]),n.useEffect(()=>{const t=o=>{if(o.target.matches("input, textarea, select")){o.key==="?"&&!o.ctrlKey&&!o.metaKey&&!o.altKey&&(C(!0),o.preventDefault());return}switch(o.key){case"?":C(!0),o.preventDefault();break;case"f":case"F":!o.ctrlKey&&!o.metaKey&&!o.altKey&&(oe(d=>!d),o.preventDefault());break;case"g":case"G":!o.ctrlKey&&!o.metaKey&&!o.altKey&&(Z(d=>d==="grid"?"list":"grid"),o.preventDefault());break;case"c":case"C":!o.ctrlKey&&!o.metaKey&&!o.altKey&&(u(!0),o.preventDefault());break;case"/":const g=document.querySelector('input[type="search"]');g&&(g.focus(),o.preventDefault());break;case"Escape":C(!1),u(!1),oe(!1),o.preventDefault();break}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]),n.useEffect(()=>{if(he&&ye.current){const t=ye.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&t[0].focus();const o=g=>{if(g.key==="Tab"){const d=t[0],w=t[t.length-1];g.shiftKey?document.activeElement===d&&(w.focus(),g.preventDefault()):document.activeElement===w&&(d.focus(),g.preventDefault())}};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)}},[he]);const $e=n.useCallback(async()=>{if(!pe.current.cards)try{pe.current.cards=!0,_(!0),T(null);const t=new URLSearchParams({limit:"100",search:r,sort_by:A.sortBy,sort_order:A.sortOrder});if(l!=="all"){const d=O.find(w=>w.name===l);d&&t.append("game_id",d.id)}A.quality!=="all"&&t.append("quality",A.quality),A.rarity!=="all"&&t.append("rarity",A.rarity),A.foilType!=="all"&&t.append("foil_type",A.foilType),A.language!=="English"&&t.append("language",A.language),A.set!=="all"&&t.append("set_name",A.set),A.minPrice&&t.append("min_price",A.minPrice),A.maxPrice&&t.append("max_price",A.maxPrice);const o=await Ft(async()=>{const d=await It(`${ne}/cards?${t}`);if(!d.ok){if(d.status===429){const w=new Error("Rate limit exceeded");throw w.status=429,w}throw new Error("API request failed")}return d.json()},3,1e3),g={};o.cards.forEach(d=>{const w=`${d.game_name}-${d.set_name}-${d.card_number}`;g[w]||(g[w]={id:w,name:d.name,game_name:d.game_name,set_name:d.set_name,set_code:d.set_code,card_number:d.card_number,rarity:d.rarity,card_type:d.card_type,description:d.description,image_url:d.image_url,variations:[]}),g[w].variations.push({inventory_id:d.inventory_id,quality:d.quality,variation_name:d.variation_name,foil_type:d.foil_type||"Regular",language:d.language||"English",price:parseFloat(d.price)*H.rate,stock:d.stock_quantity,variation_key:`${d.quality}-${d.foil_type||"Regular"}-${d.language||"English"}`})}),R(Object.values(g))}catch(t){const o=D(t,{operation:"fetchCards"});T(`${o.title}: ${o.message} Try adjusting your filters or refreshing the page.`)}finally{_(!1),pe.current.cards=!1}},[r,l,A,O,H.rate,D]);n.useEffect(()=>{O.length>0&&$e()},[$e,O]),n.useEffect(()=>()=>{const t=n.useRef(null);t.current&&clearTimeout(t.current);const o=n.useRef(null);o.current&&o.current.abort()},[]);const de=n.useCallback((t,o)=>{i(g=>{const d=new URLSearchParams(g);return o&&o!=="all"&&o!==""?d.set(t,o):d.delete(t),d})},[i]),Ge=n.useCallback(()=>{i({})},[i]),je=n.useMemo(()=>{const t=[];return Object.entries(A).forEach(([o,g])=>{if(g&&g!=="all"&&g!==""&&g!=="English"){let d=o,w=g;switch(o){case"foilType":d="Foil";break;case"minPrice":d="Min Price",w=`$${g}`;break;case"maxPrice":d="Max Price",w=`$${g}`;break;case"sortBy":d="Sort";break;case"sortOrder":return;default:d=o.charAt(0).toUpperCase()+o.slice(1);break}t.push({key:o,displayName:d,displayValue:w})}}),r&&t.push({key:"search",displayName:"Search",displayValue:r}),l!=="all"&&t.push({key:"game",displayName:"Game",displayValue:l}),t},[A,r,l]),Ye=t=>{He(t)};n.useEffect(()=>{B.length>0&&!U&&y(!0)},[B,U]);const Re=n.useCallback((t,o,g)=>{const d=B.find(w=>w.id===t&&w.quality===o);if(d){const w=d.quantity+g;Se(t,o,w)}},[B,Se]),Ae=n.useMemo(()=>B.reduce((t,o)=>t+o.price*o.quantity,0),[B]),me=n.useMemo(()=>B.reduce((t,o)=>t+o.quantity,0),[B]),re=n.useMemo(()=>{if(!N.length)return[];const{sortBy:t}=A;if(!["name","set","rarity","price","price_low","price_high"].includes(t))return[{section:null,cards:N}];const o=new Map;N.forEach(d=>{var J,ue;let w,K;if(t==="name"){const W=d.name.charAt(0).toUpperCase();w=W,K=W}else if(t==="set")w=d.set_name,K=d.set_name;else if(t==="rarity"){const W=d.rarity||"Unknown";w=W,K=W}else if(["price","price_low","price_high"].includes(t)){const W=((ue=(J=d.variations)==null?void 0:J[0])==null?void 0:ue.price)||0;let V;W<1?V="Under $1":W<5?V="$1 - $4.99":W<10?V="$5 - $9.99":W<25?V="$10 - $24.99":W<50?V="$25 - $49.99":W<100?V="$50 - $99.99":V="$100+",w=V,K=V}o.has(w)||o.set(w,{section:K,cards:[]}),o.get(w).cards.push(d)});const g=Array.from(o.values()).sort((d,w)=>{if(t==="name")return d.section.localeCompare(w.section);if(t==="set")return d.section.localeCompare(w.section);if(t==="rarity"){const K={Common:1,Uncommon:2,Rare:3,Mythic:4,"Mythic Rare":4,Special:5,Legendary:5,Basic:0,Unknown:6};return(K[d.section]||6)-(K[w.section]||6)}else if(["price","price_low","price_high"].includes(t)){const K={"Under $1":1,"$1 - $4.99":2,"$5 - $9.99":3,"$10 - $24.99":4,"$25 - $49.99":5,"$50 - $99.99":6,"$100+":7},J=K[d.section]||8,ue=K[w.section]||8;return t==="price_high"?ue-J:J-ue}return 0});return g.forEach(d=>{d.cards.sort((w,K)=>w.name.localeCompare(K.name))}),g},[N,A]),we=n.useCallback(t=>o=>{te(g=>({...g,[t]:o.target.value}))},[]),Ne=n.useCallback((t,o)=>()=>{_e({id:t.id,inventory_id:o.inventory_id,name:t.name,image_url:t.image_url,quality:o.quality,price:o.price,stock:o.stock,foil_type:o.foil_type,language:o.language,game_name:t.game_name,set_name:t.set_name,card_number:t.card_number,rarity:t.rarity})},[_e]),We=n.useCallback(()=>{u(!1),b(!0)},[]),Ze=n.useCallback(()=>{b(!1),u(!1)},[]),Qe=n.useCallback(async t=>{try{if((await fetch(`${ne}/orders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)return Ee(),!0;throw new Error("Failed to submit order")}catch(o){throw o}},[Ee]);return L||F?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-mm-cream to-mm-tealLight",children:[e.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-mm-gold focus:text-white focus:rounded-lg focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none",children:"Skip to main content"}),e.jsx("header",{className:"bg-white shadow-sm border-b border-mm-warmAccent",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"h-8 bg-mm-warmAccent rounded w-32 animate-pulse"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-6 bg-mm-warmAccent rounded w-24 animate-pulse"}),e.jsx("div",{className:"h-10 bg-mm-warmAccent rounded w-10 animate-pulse"})]})]})})}),e.jsx("main",{id:"main-content",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("aside",{className:"lg:w-64 space-y-6",children:[1,2,3,4,5].map(t=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"h-4 bg-mm-warmAccent rounded w-20 mb-3 animate-pulse"}),e.jsx("div",{className:"h-10 bg-mm-warmAccent rounded animate-pulse"})]},t))}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"h-6 bg-mm-warmAccent rounded w-48 animate-pulse"})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:12},(t,o)=>e.jsx(Lt,{},o))})]})]})}),e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:"Loading cards... If this takes a while, the API might be waking up."})]}):P||I?e.jsx("div",{className:"min-h-screen bg-mm-cream flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-2xl font-bold text-mm-darkForest mb-2",children:"Connection Error"}),e.jsx("p",{className:"text-mm-teal mb-4",children:I||P}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn-mm-primary",children:"Retry Connection"})]})}):c?e.jsx(Pe,{children:e.jsx(wt,{cart:B,currency:H,onBack:Ze,onOrderSubmit:Qe})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-mm-cream to-mm-tealLight",children:[e.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-mm-gold focus:text-white focus:rounded-lg focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none",children:"Skip to main content"}),se&&e.jsx("div",{className:"bg-red-600 text-white text-center py-2 px-4 text-sm font-medium",children:"⚠️ You are offline. Some features may not work properly."}),e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40 border-b border-mm-warmAccent",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-mm-gold to-mm-tealBright bg-clip-text text-transparent",children:"TCG Singles"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{currency:H,onCurrencyChange:Ye,className:"flex-shrink-0"}),e.jsxs("button",{onClick:()=>u(!0),className:"relative p-3 hover:bg-mm-tealLight rounded-lg transition-colors motion-reduce:transition-none focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none","aria-label":`Open shopping cart with ${me} items`,children:[e.jsx(qe,{className:"w-6 h-6 text-mm-forest"}),e.jsx("span",{className:`absolute -top-1 -right-1 ${me>0?"bg-mm-gold":"bg-mm-teal"} text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center`,"aria-live":"assertive","aria-label":`${me} items in cart`,children:me})]})]})]})})}),e.jsxs("main",{id:"main-content",className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:"lg:hidden mb-4",children:e.jsxs("button",{onClick:()=>oe(!0),className:"btn-mm-secondary w-full","aria-label":"Open filters and search panel","aria-expanded":he,children:[e.jsx(rt,{className:"w-5 h-5 text-mm-teal"}),e.jsx("span",{className:"font-medium text-mm-forest",children:"Filters & Search"}),e.jsx(at,{className:"w-4 h-4 text-mm-teal ml-auto"})]})}),e.jsxs("div",{className:"lg:flex lg:gap-6",children:[e.jsx("aside",{className:"hidden lg:block w-80 flex-shrink-0",children:e.jsxs("div",{className:"card-mm sticky top-24",children:[e.jsx("h2",{className:"text-lg font-semibold text-mm-darkForest mb-4",children:"Search & Filters"}),e.jsx(Fe,{searchTerm:r,onSearchChange:s,selectedGame:l,onGameChange:f,selectedSet:m,onSetChange:j,games:O,sets:q,additionalFilters:k,apiUrl:ne,debounceMs:300,minSearchLength:2})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-1 pr-4",children:e.jsxs("p",{className:"text-mm-teal","aria-live":"polite",children:[e.jsx("span",{className:"font-medium",children:N.length})," cards found"]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",style:{minWidth:"140px",width:"140px"},children:[e.jsx("span",{className:"text-sm text-mm-teal hidden sm:inline",style:{width:"36px"},children:"View:"}),e.jsxs("div",{className:"inline-flex rounded-lg border border-mm-warmAccent bg-white p-0.5",style:{width:"96px"},children:[e.jsx("button",{onClick:()=>Z("grid"),className:`px-3 py-2 rounded-md transition-colors motion-reduce:transition-none ${X==="grid"?"bg-mm-gold text-white shadow-sm":"text-mm-teal hover:text-mm-darkForest hover:bg-mm-tealLight"}`,style:{width:"44px",minWidth:"44px"},"aria-pressed":X==="grid","aria-label":"Switch to grid view",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Z("list"),className:`px-3 py-2 rounded-md transition-colors motion-reduce:transition-none ${X==="list"?"bg-mm-gold text-white shadow-sm":"text-mm-teal hover:text-mm-darkForest hover:bg-mm-tealLight"}`,style:{width:"44px",minWidth:"44px"},"aria-pressed":X==="list","aria-label":"Switch to list view",children:e.jsx(gt,{className:"w-5 h-5"})})]})]})]}),je.length>0&&e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-sm text-mm-teal font-medium",children:"Active filters:"}),je.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-mm-tealLight text-mm-tealBright rounded-full text-sm",children:[e.jsxs("span",{children:[t.displayName,": ",t.displayValue]}),e.jsx("button",{onClick:()=>{t.key==="search"?s(""):t.key==="game"?f("all"):de(t.key,"")},className:"ml-1 hover:bg-mm-warmAccent rounded-full w-4 h-4 flex items-center justify-center focus:ring-2 focus:ring-mm-forest focus:outline-none","aria-label":`Clear ${t.displayName} filter`,children:e.jsx(ie,{className:"w-3 h-3"})})]},t.key)),je.length>1&&e.jsx("button",{onClick:Ge,className:"px-3 py-1 text-sm text-mm-teal hover:text-mm-darkForest hover:bg-mm-tealLight rounded-full border border-mm-warmAccent focus:ring-2 focus:ring-mm-forest focus:outline-none",children:"Clear All"})]}),e.jsx("div",{className:`w-full ${X==="list"?"max-w-6xl mx-auto":""}`,children:X==="grid"?N.length>vt.INITIAL_BATCH_SIZE?e.jsx(Pe,{children:e.jsx(n.Suspense,{fallback:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-mm-gold border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-mm-teal text-sm",children:"Loading virtual scrolling..."})]}),children:e.jsx(Bt,{cards:N,CardComponent:({card:t})=>{var d;const o=Y[t.id]||((d=t.variations[0])==null?void 0:d.variation_key),g=t.variations.find(w=>w.variation_key===o)||t.variations[0];return e.jsx(fe,{card:t,selectedVariationKey:o,selectedVariation:g,currency:H,onVariationChange:we(t.id),onAddToCart:Ne(t,g)})},cardHeight:500,containerHeight:800,enableProgressiveLoading:N.length>500})})}):e.jsx("div",{children:re.map((t,o)=>e.jsxs("div",{className:"mb-8",children:[t.section&&e.jsx(ge,{title:t.section,count:t.cards.length,isGrid:!0}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-5 lg:gap-6",children:t.cards.map(g=>{var K;const d=Y[g.id]||((K=g.variations[0])==null?void 0:K.variation_key),w=g.variations.find(J=>J.variation_key===d)||g.variations[0];return e.jsx(fe,{card:g,selectedVariationKey:d,selectedVariation:w,currency:H,onVariationChange:we(g.id),onAddToCart:Ne(g,w)},g.id)})})]},o))}):e.jsx("div",{children:re.map((t,o)=>e.jsxs("div",{className:"mb-8",children:[t.section&&e.jsx(ge,{title:t.section,count:t.cards.length,isGrid:!1}),e.jsx("div",{className:"space-y-2",children:t.cards.map(g=>{var K;const d=Y[g.id]||((K=g.variations[0])==null?void 0:K.variation_key),w=g.variations.find(J=>J.variation_key===d)||g.variations[0];return e.jsx(ke,{card:g,selectedVariationKey:d,selectedVariation:w,currency:H,onVariationChange:we(g.id),onAddToCart:Ne(g,w)},g.id)})})]},o))})}),"const [loading, setLoading] = useState(false);",N.length===0&&!loading&&e.jsx("div",{className:"text-center py-12 bg-white rounded-xl shadow-sm",children:e.jsx("p",{className:"text-mm-forest text-lg",children:"No cards found matching your search"})})]})]}),he&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 lg:hidden",onClick:()=>oe(!1),children:e.jsxs("div",{ref:ye,className:"absolute right-0 top-0 h-full w-full max-w-sm bg-white shadow-2xl overflow-y-auto",style:{paddingTop:"env(safe-area-inset-top)",paddingBottom:"env(safe-area-inset-bottom)"},onClick:t=>t.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"mobile-filters-title",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h2",{id:"mobile-filters-title",className:"text-xl font-bold",children:"Filters"}),e.jsx("button",{onClick:()=>oe(!1),className:"p-2 hover:bg-mm-tealLight rounded-lg focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none","aria-label":"Close filters panel",children:e.jsx(ie,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(Fe,{searchTerm:r,onSearchChange:s,selectedGame:l,onGameChange:f,selectedSet:m,onSetChange:j,games:O,sets:q,additionalFilters:k,apiUrl:ne,debounceMs:300,minSearchLength:2}),e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx("div",{children:e.jsxs("fieldset",{children:[e.jsxs("legend",{className:"block text-sm font-medium text-mm-forest mb-2",children:["Price Range (",H.symbol,")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{id:"min-price",type:"number",placeholder:"Min",value:A.minPrice,onChange:t=>de("minPrice",t.target.value),className:"px-3 py-2 border border-mm-warmAccent rounded-lg text-sm focus:ring-2 focus:ring-mm-forest",step:"0.01",min:"0","aria-label":`Minimum price filter in ${H.symbol}`}),e.jsx("input",{id:"max-price",type:"number",placeholder:"Max",value:A.maxPrice,onChange:t=>de("maxPrice",t.target.value),className:"px-3 py-2 border border-mm-warmAccent rounded-lg text-sm focus:ring-2 focus:ring-mm-forest",step:"0.01",min:"0","aria-label":`Maximum price filter in ${H.symbol}`})]})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sort-by",className:"block text-sm font-medium text-mm-forest mb-2",children:"Sort By"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{id:"sort-by",value:A.sortBy,onChange:t=>de("sortBy",t.target.value),className:"flex-1 px-3 py-2 border border-mm-warmAccent rounded-lg text-sm focus:ring-2 focus:ring-mm-forest","aria-label":"Choose sorting method for cards",children:[e.jsxs("optgroup",{label:"📝 Basic",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"set",children:"Set"}),e.jsx("option",{value:"updated",children:"Recently Updated"})]}),e.jsx("optgroup",{label:"💎 Rarity",children:e.jsx("option",{value:"rarity",children:"By Rarity"})}),e.jsxs("optgroup",{label:"💰 Price",children:[e.jsx("option",{value:"price",children:"By Price"}),e.jsx("option",{value:"price_low",children:"Price: Low to High"}),e.jsx("option",{value:"price_high",children:"Price: High to Low"})]})]}),e.jsx("button",{onClick:()=>de("sortOrder",A.sortOrder==="asc"?"desc":"asc"),className:"px-3 py-2 border border-mm-warmAccent rounded-lg text-sm hover:bg-mm-tealLight focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none min-w-[44px] min-h-[44px] flex items-center justify-center","aria-label":`Sort ${A.sortOrder==="asc"?"descending":"ascending"}`,title:`Currently sorting ${A.sortOrder==="asc"?"ascending":"descending"}. Click to reverse.`,children:A.sortOrder==="asc"?"↑":"↓"})]})]})]}),e.jsx("button",{onClick:()=>oe(!1),className:"btn-mm-primary w-full mt-6",children:"Apply Filters"})]})]})})]}),p&&B.length>0&&!U&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-white rounded-xl shadow-lg border border-mm-warmAccent p-4 z-40 max-w-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-mm-darkForest",children:["Cart (",me,")"]}),e.jsx("button",{onClick:()=>y(!1),className:"text-mm-teal hover:text-mm-teal focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none rounded","aria-label":"Close mini cart",children:e.jsx(ie,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:[B.slice(0,3).map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-8 h-10 object-contain rounded",onError:g=>{g.target.style.display="none"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:["// @ts-expect-error TS(2339): Property 'name' does not exist on type 'never'.",e.jsx("div",{className:"truncate font-medium",children:t.name}),e.jsxs("div",{className:"text-xs text-mm-teal",children:["// @ts-expect-error TS(2339): Property 'set_name' does not exist on type 'never'... Remove this comment to see the full error message",e.jsxs("div",{className:"truncate",children:[t.set_name," #",t.card_number]}),"// @ts-expect-error TS(2339): Property 'quality' does not exist on type 'never'.",e.jsxs("div",{children:[t.quality," × ",t.quantity]}),"// @ts-expect-error TS(2339): Property 'foil_type' does not exist on type 'never... Remove this comment to see the full error message",t.foil_type&&t.foil_type!=="Regular"&&e.jsxs("div",{className:"text-yellow-600",children:["✨ ",t.foil_type]}),"// @ts-expect-error TS(2339): Property 'language' does not exist on type 'never'... Remove this comment to see the full error message",t.language&&t.language!=="English"&&e.jsx("div",{children:t.language})]})]}),e.jsxs("div",{className:"font-semibold text-mm-tealBright",children:["// @ts-expect-error TS(2339): Property 'price' does not exist on type 'never'.",H.symbol,(t.price*t.quantity).toFixed(2)]})]},`${t.id}-${t.quality}`)),B.length>3&&e.jsxs("div",{className:"text-xs text-mm-teal text-center",children:["...and ",B.length-3," more items"]})]}),e.jsxs("div",{className:"border-t mt-3 pt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"font-bold text-lg text-mm-tealBright",children:[H.symbol,Ae.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u(!0),className:"btn-mm-primary flex-1 text-sm",children:"View Cart"}),e.jsx("button",{onClick:()=>y(!1),className:"btn-mm-secondary text-sm",children:"Continue"})]})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50",onClick:()=>u(!1),children:e.jsxs("div",{className:"absolute right-0 top-0 h-full w-full max-w-md min-w-0 bg-white shadow-2xl flex flex-col overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-4 sm:px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:"Cart"}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 hover:bg-mm-tealLight rounded-lg focus:ring-4 focus:ring-mm-forest focus:ring-offset-2 focus:outline-none","aria-label":"Close cart",children:e.jsx(ie,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4",children:B.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(qe,{className:"w-16 h-16 text-mm-teal mx-auto mb-4"}),e.jsx("p",{className:"text-mm-forest",children:"Your cart is empty"})]}):e.jsx("div",{className:"space-y-4",children:B.map(t=>e.jsxs("div",{className:"flex gap-4 p-4 bg-mm-tealLight rounded-lg border border-mm-warmAccent",children:[e.jsx("img",{src:t.image_url,alt:t.name,className:"w-20 h-28 object-contain rounded bg-white",onError:o=>{o.target.onerror=null,o.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="80" height="112"%3E%3Crect fill="%231e293b" width="80" height="112"/%3E%3C/svg%3E'}}),e.jsxs("div",{className:"flex-1 min-w-0",children:["// @ts-expect-error TS(2339): Property 'name' does not exist on type 'never'.",e.jsx("h3",{className:"font-bold text-sm mb-1 line-clamp-2",children:t.name}),e.jsxs("div",{className:"text-xs text-mm-teal mb-2 space-y-1",children:["// @ts-expect-error TS(2339): Property 'game_name' does not exist on type 'never... Remove this comment to see the full error message",e.jsx("div",{className:"font-medium",children:t.game_name}),"// @ts-expect-error TS(2339): Property 'set_name' does not exist on type 'never'... Remove this comment to see the full error message",e.jsxs("div",{children:[t.set_name," #",t.card_number]}),"// @ts-expect-error TS(2339): Property 'quality' does not exist on type 'never'.",e.jsx("div",{children:t.quality}),"// @ts-expect-error TS(2339): Property 'foil_type' does not exist on type 'never... Remove this comment to see the full error message",t.foil_type&&t.foil_type!=="Regular"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"✨"}),"// @ts-expect-error TS(2339): Property 'foil_type' does not exist on type 'never... Remove this comment to see the full error message",e.jsx("span",{className:"font-medium text-yellow-600",children:t.foil_type})]}),"// @ts-expect-error TS(2339): Property 'language' does not exist on type 'never'... Remove this comment to see the full error message",t.language&&t.language!=="English"&&e.jsx("div",{className:"font-medium text-mm-forest",children:t.language})]}),"// @ts-expect-error TS(2339): Property 'price' does not exist on type 'never'.",e.jsxs("p",{className:"text-sm font-bold text-mm-tealBright mb-3",children:[H.symbol,t.price.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Re(t.id,t.quality,-1),className:"p-1.5 bg-white border rounded hover:bg-mm-tealLight focus:ring-2 focus:ring-mm-forest focus:outline-none","aria-label":`Decrease quantity of ${t.name}`,children:e.jsx(pt,{className:"w-4 h-4"})}),"// @ts-expect-error TS(2339): Property 'quantity' does not exist on type 'never'... Remove this comment to see the full error message",e.jsx("span",{className:"w-8 text-center font-medium",children:t.quantity}),e.jsx("button",{onClick:()=>Re(t.id,t.quality,1),disabled:t.quantity>=t.stock,className:"p-1.5 bg-white border rounded hover:bg-mm-tealLight disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-mm-forest focus:outline-none","aria-label":`Increase quantity of ${t.name}`,children:e.jsx(nt,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>Be(t.id,t.quality),className:"ml-auto text-red-600 hover:text-red-700 text-sm font-medium focus:ring-2 focus:ring-red-500 focus:outline-none rounded px-2 py-1","aria-label":`Remove ${t.name} from cart`,children:"Remove"})]})]})]},`${t.id}-${t.quality}`))})}),B.length>0&&e.jsxs("div",{className:"border-t px-6 py-4 bg-mm-tealLight",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total:"}),e.jsxs("span",{className:"text-3xl font-bold text-mm-tealBright",children:[H.symbol,Ae.toFixed(2)]})]}),e.jsx("button",{onClick:We,className:"btn-mm-primary w-full",children:"Proceed to Checkout"})]})]})}),Ce.length>0&&e.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:Ce.map(t=>e.jsxs("div",{className:`px-4 py-3 rounded-lg shadow-lg ${t.type==="success"?"bg-green-50 border-green-200 text-green-800":t.type==="error"?"bg-red-50 border-red-200 text-red-800":t.type==="warning"?"bg-orange-50 border-orange-200 text-orange-800":"bg-mm-tealLight border-mm-tealBright text-mm-tealBright"} border`,role:t.type==="error"?"alert":"status","aria-live":t.type==="error"?"assertive":"polite","aria-atomic":"true",children:["// @ts-expect-error TS(2339): Property 'message' does not exist on type 'never'.",t.message]},t.id))}),e.jsx("div",{"aria-live":"polite","aria-atomic":"true",className:"sr-only",children:re.length>0&&`Showing ${re.reduce((t,o)=>t+o.cards.length,0)} cards`}),e.jsxs("div",{"aria-live":"assertive","aria-atomic":"true",className:"sr-only",children:[(L||F)&&"Loading cards...",(P||I)&&`Error: ${I||P}`]}),e.jsxs("div",{role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only",children:["// @ts-expect-error TS(2304): Cannot find name 'loading'.",r&&!loading&&(re.length>0?`Found ${re.reduce((t,o)=>t+o.cards.length,0)} cards matching "${r}"`:`No cards found matching "${r}"`)]},`search-${r}-${re.length}`),e.jsx($t,{isOpen:S,onClose:()=>C(!1)})]})};export{Wt as default};
