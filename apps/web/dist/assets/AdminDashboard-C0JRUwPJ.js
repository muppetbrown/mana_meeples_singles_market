import{c as E,u as Oe,r,j as e,X as be,C as ae,b as re,T as De,a as Fe}from"./index-CEA3H4V8.js";import{R as A,F as ve,S as Ne,P as fe,c as Me,a as Le,M as qe,C as Ie,b as Ue}from"./CurrencySelector-BI_99-jY.js";import{C as Ge,U as ze,A as ie}from"./api-B2Qzce_A.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Be=E("chevron-right",He);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Qe=E("clock",Ve);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],we=E("dollar-sign",Xe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Je=E("download",Ze);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],We=E("eye",Ke);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],et=E("loader-circle",Ye);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],st=E("log-out",tt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],M=E("package",at);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],lt=E("sparkles",rt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ot=E("zoom-in",nt);var it={};const X=it.REACT_APP_API_URL||"http://localhost:5000/api",je=({mode:c="all"})=>{const[f,y]=Oe(),[k,N]=r.useState([]),[n,m]=r.useState([]),[L,w]=r.useState([]),[q,p]=r.useState(!0),[x,h]=r.useState(null),[g,F]=r.useState([]),[R,b]=r.useState(!1),[$,C]=r.useState(-1),[Z,I]=r.useState(!1),U=f.get("search")||"",j=f.get("game")||"all",O=f.get("set")||"all",z=f.get("treatment")||"all",[J,a]=r.useState([]),[i,l]=r.useState(new Set),[d,S]=r.useState(null),[Se,ce]=r.useState(!1),[_,de]=r.useState(null),[T,G]=r.useState({quality:"Near Mint",foil_type:"Regular",price:"",stock_quantity:1,language:"English"}),[K,me]=r.useState(!1),H=r.useRef(null),V=r.useRef(null),D=c==="inventory",W=r.useCallback(async t=>{y(s=>{const o=new URLSearchParams(s);return t?o.set("search",t):o.delete("search"),o}),V.current&&clearTimeout(V.current),H.current&&H.current.abort(),t.length>=2?(I(!0),V.current=setTimeout(async()=>{try{H.current=new AbortController;const s=await fetch(`${X}/search/autocomplete?q=${encodeURIComponent(t)}`,{signal:H.current.signal,credentials:"include"});if(s.ok){const o=await s.json();F(o.suggestions||[]),b(!0),C(-1)}}catch(s){s.name!=="AbortError"&&console.error("Autocomplete error:",s)}finally{I(!1)}},300)):(F([]),b(!1),C(-1),I(!1))},[y]);r.useEffect(()=>()=>{V.current&&clearTimeout(V.current),H.current&&H.current.abort()},[]);const xe=r.useCallback(async()=>{try{const t=await fetch(`${X}/games`);if(!t.ok)throw new Error("Failed to fetch games");const s=await t.json();m(s.games||[])}catch(t){console.error("Error fetching games:",t)}},[]),he=t=>({"Magic: The Gathering":1,Pokemon:2,"Yu-Gi-Oh!":3})[t]||null,ue=r.useCallback(async()=>{if(j==="all"){a([]);return}try{const t=he(j);if(!t)return;const s=await fetch(`${X}/sets?game_id=${t}`);if(s.ok){const o=await s.json();a(o),w(o)}else console.error("Failed to fetch sets"),a([]),w([])}catch(t){console.error("Error fetching sets:",t),a([]),w([])}},[j]),Y=r.useCallback((t,s)=>{y(o=>{const v=new URLSearchParams(o);return s&&s!=="all"&&s!==""?v.set(t,s):v.delete(t),v})},[y]),ke=r.useCallback(t=>{y(s=>{const o=new URLSearchParams(s);return t&&t!=="all"?o.set("game",t):o.delete("game"),o})},[y]),Q=r.useCallback(async()=>{p(!0);try{const t=new URLSearchParams({limit:String(1e3)});if(j!=="all"){const v=he(j);v&&t.append("game_id",v)}O!=="all"&&t.append("set_name",O),z!=="all"&&t.append("treatment",z),U&&t.append("search",U);const s=await fetch(`${X}/admin/all-cards?${t}`,{credentials:"include"});if(!s.ok)throw new Error(`Failed to fetch cards: ${s.statusText}`);const o=await s.json();N(o.cards||[]),h(null)}catch(t){console.error("Error fetching cards:",t),h(t.message)}finally{p(!1)}},[j,O,z,U]);r.useEffect(()=>{xe(),Q()},[xe,Q]),r.useEffect(()=>{ue(),O!=="all"&&Y("set","all")},[j,ue]);const B=r.useMemo(()=>{let t=k;return D&&(t=t.filter(s=>s.has_inventory&&s.total_stock>0)),t},[k,D]),pe=t=>!t||t.length===0?[]:[...new Set(t.map(s=>s.treatment))],ge=t=>!t||t.length===0?[]:[...new Set(t.map(s=>s.finish))],Ce=t=>{l(s=>{const o=new Set(s);return o.has(t)?o.delete(t):o.add(t),o})},ee=t=>({STANDARD:"bg-slate-100 text-slate-700 border-slate-300",BORDERLESS:"bg-purple-100 text-purple-700 border-purple-300",EXTENDED_ART:"bg-blue-100 text-blue-700 border-blue-300",SHOWCASE:"bg-pink-100 text-pink-700 border-pink-300",PROMO:"bg-amber-100 text-amber-700 border-amber-300",EXTENDED:"bg-indigo-100 text-indigo-700 border-indigo-300"})[t]||"bg-gray-100 text-gray-700 border-gray-300",te=t=>t==="foil"?"bg-gradient-to-r from-yellow-100 to-amber-100 text-amber-800 border-amber-300":"bg-slate-100 text-slate-600 border-slate-300",_e=(t,s)=>{de({card:t,variation:s}),G({quality:"Near Mint",foil_type:s.finish==="foil"?"Foil":"Regular",price:"",stock_quantity:1,language:"English"}),ce(!0)},se=()=>{ce(!1),de(null),G({quality:"Near Mint",foil_type:"Regular",price:"",stock_quantity:1,language:"English"})},Te=async()=>{if(_){me(!0);try{const t=await fetch(`${X}/admin/inventory`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({card_id:_.variation.card_id,quality:T.quality,foil_type:T.foil_type,price:parseFloat(T.price)||0,stock_quantity:parseInt(String(T.stock_quantity),10)||0,language:T.language})});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to add to inventory")}await Q(),se(),alert(`✅ ${_.card.name} added to inventory successfully!`)}catch(t){console.error("Error adding to inventory:",t),alert(`❌ Error: ${t.message}`)}finally{me(!1)}}},Pe=()=>{const t=[["Card Name","Number","Set","Rarity","Treatments","Finishes","Stock","Variations"].join(","),...B.map(P=>[`"${P.name}"`,P.card_number,P.set_name,P.rarity||"",pe(P.variations).join(";"),ge(P.variations).join(";"),P.total_stock,P.variation_count].join(","))].join(`
`),s=new Blob([t],{type:"text/csv"}),o=window.URL.createObjectURL(s),v=document.createElement("a");v.href=o,v.download=`${D?"inventory":"all-cards"}-${new Date().toISOString().split("T")[0]}.csv`,v.click(),window.URL.revokeObjectURL(o)};if(q)return e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Loading cards..."})]});if(x)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-red-700 font-medium",children:"Error loading cards"}),e.jsx("p",{className:"text-red-600 text-sm mt-2",children:x}),e.jsx("button",{onClick:Q,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Try Again"})]});const Ae=B.reduce((t,s)=>t+s.total_stock,0),Ee=B.reduce((t,s)=>t+s.variation_count,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:D?"Inventory Management":"All Cards Database"}),e.jsxs("p",{className:"text-slate-600 mt-1",children:[B.length," cards • ",Ee," variations",D&&` • ${Ae} in stock`]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(A,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:Pe,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(Je,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-700 font-medium",children:[e.jsx(ve,{className:"w-5 h-5"}),"Filters"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),Z&&e.jsx(A,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500 animate-spin"}),e.jsx("input",{type:"search",placeholder:"Search cards...",value:U,onChange:t=>W(t.target.value),onFocus:()=>b(g.length>0),onBlur:t=>{var s;(s=t.relatedTarget)!=null&&s.closest("#search-suggestions")||setTimeout(()=>b(!1),200)},onKeyDown:t=>{if(R)switch(t.key){case"ArrowDown":t.preventDefault(),C(s=>s<g.length-1?s+1:0);break;case"ArrowUp":t.preventDefault(),C(s=>s>0?s-1:g.length-1);break;case"Enter":if($>=0&&g[$]){t.preventDefault();const s=g[$];W(s.name),b(!1),C(-1)}break;case"Escape":b(!1),C(-1);break}},className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","aria-label":"Search for cards by name, set, or number","aria-expanded":R,"aria-haspopup":"listbox",role:"combobox",autoComplete:"off"}),R&&e.jsx("div",{id:"search-suggestions",className:"absolute z-50 w-full bg-white border border-slate-300 rounded-lg shadow-lg mt-1 max-h-64 overflow-y-auto",role:"listbox",children:Z?e.jsxs("div",{className:"px-3 py-2 text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),"Searching..."]}):g.length>0?g.map((t,s)=>e.jsxs("button",{type:"button",className:`w-full px-3 py-2 text-left hover:bg-slate-100 focus:bg-slate-100 focus:ring-2 focus:ring-blue-500 focus:outline-none flex items-center gap-2 border-b last:border-b-0 ${$===s?"bg-slate-100":""}`,onMouseDown:()=>{W(t.name),b(!1),C(-1)},onMouseEnter:()=>C(s),role:"option","aria-selected":$===s,"aria-label":`Select ${t.name} from ${t.set_name}`,children:["// @ts-expect-error TS(2339): Property 'image_url' does not exist on type 'never... Remove this comment to see the full error message",t.image_url&&e.jsx("img",{src:t.image_url,alt:t.name,className:"w-8 h-8 rounded object-cover flex-shrink-0",loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"font-medium text-slate-900 truncate",children:["// @ts-expect-error TS(2339): Property 'name' does not exist on type 'never'.",t.name]}),e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:["// @ts-expect-error TS(2339): Property 'set_name' does not exist on type 'never'... Remove this comment to see the full error message",t.set_name," • #",t.card_number]})]})]},s)):e.jsxs("div",{className:"px-3 py-2 text-slate-500 text-sm",children:['No cards found matching "',U,'"']})})]}),e.jsxs("select",{value:j,onChange:t=>ke(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Games"}),n.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:O,onChange:t=>Y("set",t.target.value),disabled:j==="all",className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-slate-100",children:[e.jsx("option",{value:"all",children:"All Sets"}),J.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]}),j==="all"&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Select a game to filter by set"})]}),!D&&e.jsxs("select",{value:z,onChange:t=>Y("treatment",t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Treatments"}),e.jsx("option",{value:"STANDARD",children:"Standard"}),e.jsx("option",{value:"BORDERLESS",children:"Borderless"}),e.jsx("option",{value:"EXTENDED_ART",children:"Extended Art"}),e.jsx("option",{value:"EXTENDED",children:"Extended"}),e.jsx("option",{value:"SHOWCASE",children:"Showcase"}),e.jsx("option",{value:"PROMO",children:"Promo"})]})]})]}),e.jsx("div",{className:"space-y-3",children:B.map(t=>{const s=`${t.name}-${t.card_number}`,o=i.has(s),v=pe(t.variations),P=ge(t.variations);return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>Ce(s),className:"w-full px-4 py-3 flex items-center gap-4 hover:bg-slate-50 transition-colors text-left",children:[e.jsxs("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden bg-slate-100 flex-shrink-0 group",children:["// @ts-expect-error TS(2339): Property 'image_url' does not exist on type 'never... Remove this comment to see the full error message",t.image_url?e.jsxs(e.Fragment,{children:["// @ts-expect-error TS(2339): Property 'image_url' does not exist on type 'never... Remove this comment to see the full error message",e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:u=>{u.stopPropagation(),S(t.image_url)},className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ot,{className:"w-6 h-6 text-white"})})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(M,{className:"w-6 h-6 text-slate-400"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:["// @ts-expect-error TS(2339): Property 'name' does not exist on type 'never'.",e.jsx("h3",{className:"font-semibold text-slate-900 truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-slate-600",children:["// @ts-expect-error TS(2339): Property 'card_number' does not exist on type 'nev... Remove this comment to see the full error message",e.jsxs("span",{children:["#",t.card_number]}),e.jsx("span",{children:"•"}),"// @ts-expect-error TS(2339): Property 'set_name' does not exist on type 'never'... Remove this comment to see the full error message",e.jsx("span",{children:t.set_name}),"// @ts-expect-error TS(2339): Property 'rarity' does not exist on type 'never'.",t.rarity&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),"// @ts-expect-error TS(2339): Property 'rarity' does not exist on type 'never'.",e.jsx("span",{children:t.rarity})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[v.map(u=>e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${ee(u)}`,children:["// @ts-expect-error TS(2322): Type 'unknown' is not assignable to type 'ReactNod... Remove this comment to see the full error message",u]},u)),P.map(u=>e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${te(u)}`,children:["// @ts-expect-error TS(2322): Type 'unknown' is not assignable to type 'ReactNod... Remove this comment to see the full error message",u]},u))]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900",children:["// @ts-expect-error TS(2339): Property 'variation_count' does not exist on type ... Remove this comment to see the full error message",t.variation_count," ",t.variation_count===1?"variation":"variations"]}),"// @ts-expect-error TS(2339): Property 'has_inventory' does not exist on type 'n... Remove this comment to see the full error message",t.has_inventory&&e.jsxs("div",{className:`text-xs font-medium ${t.total_stock<=3?"text-orange-600":"text-green-600"}`,children:["// @ts-expect-error TS(2339): Property 'total_stock' does not exist on type 'nev... Remove this comment to see the full error message",t.total_stock," in stock"]})]}),e.jsx(lt,{className:`w-5 h-5 text-slate-400 transition-transform ${o?"rotate-180":""}`})]})]})})]}),o&&e.jsx("div",{className:"border-t border-slate-200 bg-slate-50 p-4",children:e.jsxs("div",{className:"space-y-2",children:["// @ts-expect-error TS(2339): Property 'variations' does not exist on type 'neve... Remove this comment to see the full error message",t.variations.map((u,Re)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"font-medium text-slate-900 min-w-[150px]",children:u.variation_label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium border ${ee(u.treatment)}`,children:u.treatment}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium border ${te(u.finish)}`,children:u.finish})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:u.inventory_count>0?e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:[u.stock," in stock"]}),e.jsxs("span",{className:"text-slate-500 ml-2",children:["(",u.inventory_count," entries)"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-slate-500",children:"Not in inventory"}),!D&&e.jsxs("button",{onClick:$e=>{$e.stopPropagation(),_e(t,u)},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),"Add to Inventory"]})]})})]},Re))]})})]},s)})}),B.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border",children:[e.jsx(M,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 text-lg font-medium",children:D?"No items in inventory":"No cards found"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:D?"Add items from the All Cards tab":"Try adjusting your filters"})]}),Se&&_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:"Add to Inventory"}),e.jsx("button",{onClick:se,className:"text-slate-400 hover:text-slate-600",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg",children:["// @ts-expect-error TS(2339): Property 'card' does not exist on type 'never'.",e.jsx("div",{className:"font-medium text-slate-900",children:_.card.name}),e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:["// @ts-expect-error TS(2339): Property 'variation' does not exist on type 'never... Remove this comment to see the full error message",_.variation.variation_label]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:["// @ts-expect-error TS(2339): Property 'variation' does not exist on type 'never... Remove this comment to see the full error message",e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${ee(_.variation.treatment)}`,children:["// @ts-expect-error TS(2339): Property 'variation' does not exist on type 'never... Remove this comment to see the full error message",_.variation.treatment]}),"// @ts-expect-error TS(2339): Property 'variation' does not exist on type 'never... Remove this comment to see the full error message",e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${te(_.variation.finish)}`,children:["// @ts-expect-error TS(2339): Property 'variation' does not exist on type 'never... Remove this comment to see the full error message",_.variation.finish]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Quality/Condition"}),e.jsxs("select",{value:T.quality,onChange:t=>G(s=>({...s,quality:t.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"Near Mint",children:"Near Mint"}),e.jsx("option",{value:"Lightly Played",children:"Lightly Played"}),e.jsx("option",{value:"Moderately Played",children:"Moderately Played"}),e.jsx("option",{value:"Heavily Played",children:"Heavily Played"}),e.jsx("option",{value:"Damaged",children:"Damaged"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Foil Type"}),e.jsxs("select",{value:T.foil_type,onChange:t=>G(s=>({...s,foil_type:t.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"Regular",children:"Regular (Non-foil)"}),e.jsx("option",{value:"Foil",children:"Foil"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Price (NZD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:T.price,onChange:t=>G(s=>({...s,price:t.target.value})),placeholder:"0.00",className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Initial Stock Quantity"}),e.jsx("input",{type:"number",min:"0",value:T.stock_quantity,onChange:t=>G(s=>({...s,stock_quantity:parseInt(t.target.value,10)||0})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Language"}),e.jsxs("select",{value:T.language,onChange:t=>G(s=>({...s,language:t.target.value})),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Japanese",children:"Japanese"}),e.jsx("option",{value:"Spanish",children:"Spanish"}),e.jsx("option",{value:"French",children:"French"}),e.jsx("option",{value:"German",children:"German"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:se,disabled:K,className:"flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:Te,disabled:K,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2",children:K?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 animate-spin"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"}),"Add to Inventory"]})})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:()=>S(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[e.jsxs("button",{onClick:()=>S(null),className:"absolute -top-12 right-0 text-white hover:text-slate-300 flex items-center gap-2 px-4 py-2 bg-black/50 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5"}),"Close"]}),e.jsx("img",{src:d,alt:"Card preview",className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",onClick:t=>t.stopPropagation()})]})})]})};var ct={};const le=ct.REACT_APP_API_URL||"http://localhost:5000/api",ye=(c,f)=>console.error("Error:",c.message||c,f),ne=()=>({"Content-Type":"application/json"}),dt=()=>{var J;const[c,f]=r.useState([]),[y,k]=r.useState(!0),[N,n]=r.useState(null),[m,L]=r.useState(""),[w,q]=r.useState("all"),[p,x]=r.useState(new Set),[h,g]=r.useState(null),[F,R]=r.useState(!1),b=r.useCallback(async()=>{try{k(!0);const a=await fetch(`${le}/admin/orders?limit=100`,{credentials:"include",headers:ne()});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const i=await a.json();f(i.orders||[]),n(null)}catch(a){ye(a,{operation:"fetchOrders",context:"AdminOrders"}),n("Failed to load orders")}finally{k(!1)}},[]);r.useEffect(()=>{b()},[b]);const $=c.filter(a=>{var d,S;const i=m===""||((d=a.customer_email)==null?void 0:d.toLowerCase().includes(m.toLowerCase()))||((S=a.customer_name)==null?void 0:S.toLowerCase().includes(m.toLowerCase()))||a.id.toString().includes(m),l=w==="all"||a.status===w;return i&&l}),C=r.useCallback(a=>{x(i=>{const l=new Set(i);return l.has(a)?l.delete(a):l.add(a),l})},[]),Z=(a,i)=>{var d;return(d={pending:["confirmed","cancelled"],confirmed:["completed","cancelled"],completed:[],cancelled:[]}[a])!=null&&d.includes(i)?{valid:!0}:{valid:!1,message:`Cannot change order from ${a} to ${i}`}},I=r.useCallback(async(a,i)=>{const l=c.find(S=>S.id===a);if(!l){window.alert("Order not found");return}const d=Z(l.status,i);if(!d.valid){window.alert(d.message);return}try{if(!(await fetch(`${le}/admin/orders/${a}/status`,{method:"PUT",credentials:"include",headers:ne(),body:JSON.stringify({status:i})})).ok)throw new Error("Failed to update order status");b()}catch(S){ye(S,{operation:"updateOrderStatus",orderId:a,newStatus:i}),window.alert("Failed to update order status")}},[c,b]),U=r.useCallback(async a=>{try{const i=await fetch(`${le}/admin/orders/${a}`,{credentials:"include",headers:ne()});if(!i.ok)throw new Error("Failed to fetch order details");const l=await i.json();g(l),R(!0)}catch{window.alert("Failed to load order details")}},[]),j=({status:a})=>{const i={pending:{color:"bg-yellow-50 text-yellow-900 border border-yellow-200",icon:Qe},confirmed:{color:"bg-blue-50 text-blue-900 border border-blue-200",icon:ae},completed:{color:"bg-green-50 text-green-900 border border-green-200",icon:ae},cancelled:{color:"bg-red-50 text-red-900 border border-red-200",icon:re}},l=i[a]||i.pending,d=l.icon;return e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${l.color}`,children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),a.charAt(0).toUpperCase()+a.slice(1)]})},O=a=>new Date(a).toLocaleString(),z=a=>{try{return JSON.parse(a)}catch{return null}};return y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Loading orders..."})]})}):N?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ge,{className:"w-8 h-8 text-red-600 mx-auto mb-4"}),e.jsx("p",{className:"text-red-800 font-medium",children:N}),e.jsx("button",{onClick:b,className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"Try Again"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Order Management"}),e.jsxs("p",{className:"text-slate-600 text-sm",children:[$.length," orders"]})]}),e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:[e.jsx(A,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),e.jsx("input",{type:"search",placeholder:"Search by order ID, customer name, or email...",value:m,onChange:a=>L(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-slate-500"}),e.jsxs("select",{value:w,onChange:a=>q(a.target.value),className:"px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:$.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-12 h-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 text-lg font-medium",children:"No orders found"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Orders will appear here when customers place them"})]}):e.jsx("div",{className:"divide-y divide-slate-200",children:$.map(a=>{const i=p.has(a.id),l=z(a.payment_intent_id);return e.jsxs("div",{className:"p-4 hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>C(a.id),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{className:"p-1 hover:bg-slate-200 rounded transition-colors",children:i?e.jsx(Me,{className:"w-4 h-4 text-slate-500"}):e.jsx(Be,{className:"w-4 h-4 text-slate-500"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:["// @ts-expect-error TS(2339): Property 'id' does not exist on type 'never'.",e.jsxs("span",{className:"font-medium text-slate-900",children:["Order #",a.id]}),"// @ts-expect-error TS(2339): Property 'status' does not exist on type 'never'.",e.jsx(j,{status:a.status})]}),e.jsxs("div",{className:"text-sm text-slate-600 mt-1",children:["// @ts-expect-error TS(2339): Property 'customer_name' does not exist on type 'n... Remove this comment to see the full error message",a.customer_name," • ",a.customer_email]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-slate-900",children:["// @ts-expect-error TS(2339): Property 'total' does not exist on type 'never'. $",parseFloat(a.total).toFixed(2)]}),e.jsxs("div",{className:"text-sm text-slate-500",children:["// @ts-expect-error TS(2339): Property 'created_at' does not exist on type 'neve... Remove this comment to see the full error message",O(a.created_at)]})]})]}),i&&e.jsxs("div",{className:"mt-4 ml-8 space-y-4",children:[l&&e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-slate-900 mb-3 flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),"Customer Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Name:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[l.firstName," ",l.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Email:"}),e.jsx("span",{className:"ml-2 font-medium",children:e.jsx("a",{href:`mailto:${l.email}`,className:"text-blue-600 hover:underline",children:l.email})})]}),l.phone&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Phone:"}),e.jsx("span",{className:"ml-2 font-medium",children:e.jsx("a",{href:`tel:${l.phone}`,className:"text-blue-600 hover:underline",children:l.phone})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Country:"}),e.jsx("span",{className:"ml-2 font-medium",children:l.country})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Le,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium text-slate-700",children:"Shipping Address"})]}),e.jsxs("div",{className:"text-sm text-slate-600 leading-relaxed",children:[l.address,e.jsx("br",{}),l.suburb&&`${l.suburb}, `,l.city,", ",l.region," ",l.postalCode,e.jsx("br",{}),l.country]})]}),l.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Order Notes:"}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1 italic",children:['"',l.notes,'"']})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:d=>{d.stopPropagation(),U(a.id)},className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(We,{className:"w-4 h-4"}),"View Details"]}),"// @ts-expect-error TS(2339): Property 'status' does not exist on type 'never'.",a.status==="pending"&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),I(a.id,"confirmed")},className:"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),"Confirm"]}),"// @ts-expect-error TS(2339): Property 'status' does not exist on type 'never'.",a.status==="confirmed"&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),I(a.id,"completed")},className:"flex items-center gap-2 px-3 py-2 bg-green-600 hover:bg-green-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"Mark Completed"]}),"// @ts-expect-error TS(2339): Property 'status' does not exist on type 'never'.",a.status!=="cancelled"&&e.jsxs("button",{onClick:d=>{d.stopPropagation(),window.confirm("Are you sure you want to cancel this order? This will restore inventory.")&&I(a.id,"cancelled")},className:"flex items-center gap-2 px-3 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{onClick:d=>{d.stopPropagation(),window.open(`mailto:${a.customer_email}?subject=Order Update #${a.id}`)},className:"flex items-center gap-2 px-3 py-2 bg-slate-600 hover:bg-slate-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(qe,{className:"w-4 h-4"}),"Email Customer"]})]})]})]},a.id)})})}),F&&h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900",children:["// @ts-expect-error TS(2339): Property 'id' does not exist on type 'never'. Order #",h.id," Details"]}),e.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(re,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-4",children:"Order Items"}),e.jsxs("div",{className:"bg-slate-50 rounded-lg overflow-hidden",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-slate-700",children:"Item"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-medium text-slate-700",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-slate-700",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-slate-700",children:"Total"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:["// @ts-expect-error TS(2339): Property 'items' does not exist on type 'never'.",(J=h.items)==null?void 0:J.map((a,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-900",children:a.card_name}),e.jsx("div",{className:"text-sm text-slate-600",children:a.quality})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:a.quantity}),e.jsxs("td",{className:"px-4 py-3 text-right",children:["$",parseFloat(a.unit_price).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 text-right font-medium",children:["$",parseFloat(a.total_price).toFixed(2)]})]},i))]})]}),e.jsx("div",{className:"px-4 py-3 bg-slate-100 border-t border-slate-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold text-slate-900",children:"Order Total:"}),e.jsxs("span",{className:"text-xl font-bold text-slate-900",children:["// @ts-expect-error TS(2339): Property 'total' does not exist on type 'never'. $",parseFloat(h.total).toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"Order Status"}),"// @ts-expect-error TS(2339): Property 'status' does not exist on type 'never'.",e.jsx(j,{status:h.status})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-slate-900 mb-2",children:"Timestamps"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Created:"}),"// @ts-expect-error TS(2339): Property 'created_at' does not exist on type 'neve... Remove this comment to see the full error message",e.jsx("span",{className:"ml-2",children:O(h.created_at)})]}),"// @ts-expect-error TS(2339): Property 'updated_at' does not exist on type 'neve... Remove this comment to see the full error message",h.updated_at!==h.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-600",children:"Updated:"}),"// @ts-expect-error TS(2339): Property 'updated_at' does not exist on type 'neve... Remove this comment to see the full error message",e.jsx("span",{className:"ml-2",children:O(h.updated_at)})]})]})]})]})]})]})})]})},oe=new Intl.NumberFormat("en-NZ",{style:"currency",currency:"NZD"}),mt=()=>{const[c,f]=r.useState(null),[y,k]=r.useState(!0),N=r.useCallback(async()=>{k(!0);try{const n=await fetch(`${ie}/admin/inventory`,{credentials:"include"});if(!n.ok)throw new Error("Failed to fetch data");const L=(await n.json()).inventory??[],w={totalCards:L.length,totalValue:0,totalStock:0,lowStock:0,outOfStock:0,byGame:{},byQuality:{},byPriceSource:{}},q=L.reduce((p,x)=>{const h=x.stock_quantity*x.price;p.totalValue+=h,p.totalStock+=x.stock_quantity,x.stock_quantity===0?p.outOfStock+=1:x.stock_quantity<=3&&(p.lowStock+=1);const g=p.byGame[x.game_name]??{count:0,value:0,stock:0};g.count+=1,g.value+=h,g.stock+=x.stock_quantity,p.byGame[x.game_name]=g;const F=p.byQuality[x.quality]??{count:0,value:0};F.count+=1,F.value+=h,p.byQuality[x.quality]=F;const R=(x.price_source??"manual").toLowerCase();return p.byPriceSource[R]=(p.byPriceSource[R]??0)+1,p},w);f(q)}catch(n){console.error("Error fetching analytics:",n),f(null)}finally{k(!1)}},[]);return r.useEffect(()=>{N()},[N]),y?e.jsxs("div",{className:"flex items-center justify-center h-64",role:"status","aria-live":"polite",children:[e.jsx(A,{className:"w-8 h-8 animate-spin text-blue-600","aria-hidden":"true"}),e.jsx("span",{className:"ml-3",children:"Loading analytics…"})]}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Business insights and metrics"})]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-600","aria-label":"Refresh analytics",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Total Value"}),e.jsx(we,{className:"w-5 h-5 text-green-600","aria-hidden":"true"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900",children:oe.format(c.totalValue)})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Total Stock"}),e.jsx(M,{className:"w-5 h-5 text-blue-600","aria-hidden":"true"})]}),e.jsx("div",{className:"text-3xl font-bold text-slate-900",children:c.totalStock}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[c.totalCards," unique items"]})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Low Stock"}),e.jsx(De,{className:"w-5 h-5 text-amber-600","aria-hidden":"true"})]}),e.jsx("div",{className:"text-3xl font-bold text-amber-600",children:c.lowStock}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Items need restocking"})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600 text-sm",children:"Out of Stock"}),e.jsx(M,{className:"w-5 h-5 text-red-600","aria-hidden":"true"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-600",children:c.outOfStock}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Items unavailable"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"By Game"}),e.jsx("div",{className:"space-y-3",children:Object.entries(c.byGame).map(([n,m])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-700",children:n}),e.jsxs("span",{className:"font-medium text-slate-900",children:[m.count," items"]})]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[oe.format(m.value)," • ",m.stock," units"]})]},n))})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"By Quality"}),e.jsx("div",{className:"space-y-3",children:Object.entries(c.byQuality).map(([n,m])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-700",children:n}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium text-slate-900",children:[m.count," items"]}),e.jsx("div",{className:"text-xs text-slate-500",children:oe.format(m.value)})]})]},n))})]}),e.jsxs("div",{className:"bg-white rounded-lg border p-6",children:[e.jsx("h3",{className:"font-semibold text-slate-900 mb-4",children:"Price Sources"}),e.jsx("div",{className:"space-y-3",children:Object.entries(c.byPriceSource).map(([n,m])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-700 capitalize",children:n}),e.jsxs("span",{className:"font-medium text-slate-900",children:[m," items"]})]},n))})]})]})]}):e.jsxs("div",{className:"text-center py-12",role:"status","aria-live":"polite",children:[e.jsx("p",{className:"text-slate-500",children:"Failed to load analytics"}),e.jsxs("button",{onClick:N,className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-blue-600",children:[e.jsx(A,{className:"w-4 h-4","aria-hidden":"true"}),"Retry"]})]})},xt=()=>({"Content-Type":"application/json"}),gt=()=>{const c=Fe(),[f,y]=r.useState(!1),[k,N]=r.useState(!0),[n,m]=r.useState("inventory"),[L,w]=r.useState({symbol:"NZ$",rate:1,code:"NZD"});r.useEffect(()=>{(async()=>{try{const h=await fetch(`${ie}/auth/admin/auth/check`,{credentials:"include",headers:xt()});h.ok&&(await h.json()).authenticated?y(!0):c("/admin/login")}catch(h){console.error("Auth check failed:",h),c("/admin/login")}finally{N(!1)}})()},[c]);const q=x=>{w(x)},p=async()=>{try{await fetch(`${ie}/auth/admin/logout`,{method:"POST",credentials:"include"}),c("/admin/login")}catch(x){console.error("Logout failed:",x)}};return k?e.jsxs("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:[e.jsx(et,{className:"inline-block animate-spin h-12 w-12 text-blue-600"}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Checking authentication..."})]}):f?e.jsxs("div",{className:"min-h-screen bg-slate-50",children:[e.jsx("header",{className:"bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ie,{currency:L,onCurrencyChange:q}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 text-slate-700 hover:bg-slate-100 rounded-lg",children:[e.jsx(st,{className:"w-4 h-4"}),"Logout"]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>m("inventory"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors whitespace-nowrap border ${n==="inventory"?"bg-blue-600 text-white border-blue-600":"text-slate-700 hover:bg-slate-100 border-transparent"}`,children:[e.jsx(M,{className:"w-5 h-5"}),"Inventory"]}),e.jsxs("button",{onClick:()=>m("all-cards"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors whitespace-nowrap border ${n==="all-cards"?"bg-blue-600 text-white border-blue-600":"text-slate-700 hover:bg-slate-100 border-transparent"}`,children:[e.jsx(M,{className:"w-5 h-5"}),"All Cards"]}),e.jsxs("button",{onClick:()=>m("analytics"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors whitespace-nowrap border ${n==="analytics"?"bg-blue-600 text-white border-blue-600":"text-slate-700 hover:bg-slate-100 border-transparent"}`,children:[e.jsx(we,{className:"w-5 h-5"}),"Analytics"]}),e.jsxs("button",{onClick:()=>m("orders"),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors whitespace-nowrap border ${n==="orders"?"bg-blue-600 text-white border-blue-600":"text-slate-700 hover:bg-slate-100 border-transparent"}`,children:[e.jsx(Ue,{className:"w-5 h-5"}),"Orders"]})]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[n==="inventory"&&e.jsx(je,{mode:"inventory"}),n==="all-cards"&&e.jsx(je,{mode:"all"}),n==="analytics"&&e.jsx(mt,{}),n==="orders"&&e.jsx(dt,{})]})]}):null};export{gt as default};
